{"version":3,"sources":["../../../src/middleware/authmiddleware.js"],"names":["TOKENTIME","config","SECRET","SECRETKey","authenticate","secret","generateAccessToken","req","res","next","token","result","success","jwt","sign","id","body","username","iat","Math","floor","Date","now","expiresIn","days","moment","duration","asDays","respond","status","json","user","hospitalList","module","exports"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA,IAAMA,YAAYC,eAAOD,SAAzB;AACA,IAAME,SAASD,eAAOE,SAAtB;;AAEA,IAAIC,eAAe,0BAAW,EAAEC,QAAQH,MAAV,EAAX,CAAnB;;AAEA,IAAII,sBAAsB,SAAtBA,mBAAsB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5CF,MAAIG,KAAJ,GAAYH,IAAIG,KAAJ,IAAa,EAAzB;AACAH,MAAII,MAAJ,CAAWC,OAAX,GAAqBL,IAAII,MAAJ,CAAWC,OAAX,IAAsB,KAA3C;AACA,MAAIL,IAAII,MAAJ,CAAWC,OAAX,IAAsB,IAA1B,EAAgC;AAC9BL,QAAIG,KAAJ,GAAYG,uBAAIC,IAAJ,CACV;AACEC,UAAIR,IAAIS,IAAJ,CAASC,QADf;AAEEC,WAAKC,KAAKC,KAAL,CAAWC,KAAKC,GAAL,KAAa,IAAxB,IAAgC;AAFvC,KADU,EAKVpB,MALU,EAMV;AACEqB,iBAAW,KADb,CACmB;AADnB,KANU,CAAZ;AAUAd;AACD;AACF,CAhBD;AAiBA,IAAMe,OAAOC,iBAAOC,QAAP,CAAgB1B,SAAhB,EAA2B,SAA3B,EAAsC2B,MAAtC,EAAb;AACA,IAAIC,UAAU,SAAVA,OAAU,CAACrB,GAAD,EAAMC,GAAN,EAAc;AAC1BA,MAAIqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,UAAMxB,IAAIwB,IADS;AAEnBrB,WAAOH,IAAIG,KAFQ;AAGnBc,UAAMA,IAHa;AAInBQ,kBAAczB,IAAII,MAAJ,CAAWqB;AAJN,GAArB;AAMD,CAPD;;AASAC,OAAOC,OAAP,GAAiB;AACf9B,4BADe;AAEfE,0CAFe;AAGfsB;AAHe,CAAjB","file":"authmiddleware.js","sourcesContent":["import jwt from \"jsonwebtoken\";\nimport expressjwt from \"express-jwt\";\nimport config from \"../keys/keys\";\nimport moment from \"moment\";\nimport { debugLog } from \"../utils/logging\";\nconst TOKENTIME = config.TOKENTIME;\nconst SECRET = config.SECRETKey;\n\nlet authenticate = expressjwt({ secret: SECRET });\n\nlet generateAccessToken = (req, res, next) => {\n  req.token = req.token || {};\n  req.result.success = req.result.success || false;\n  if (req.result.success == true) {\n    req.token = jwt.sign(\n      {\n        id: req.body.username,\n        iat: Math.floor(Date.now() / 1000) - 30\n      },\n      SECRET,\n      {\n        expiresIn: \"10h\" //TOKENTIME\n      }\n    );\n    next();\n  }\n};\nconst days = moment.duration(TOKENTIME, \"seconds\").asDays();\nlet respond = (req, res) => {\n  res.status(200).json({\n    user: req.user,\n    token: req.token,\n    days: days,\n    hospitalList: req.result.hospitalList\n  });\n};\n\nmodule.exports = {\n  authenticate,\n  generateAccessToken,\n  respond\n};\n"]}