{"version":3,"sources":["../../../src/model/ucaf.js"],"names":["getPatientUCAF","req","res","next","db","httpStatus","dataBaseNotInitilizedError","getConnection","error","connection","query","patient_id","visit_date","result","records","e","module","exports"],"mappings":"AAAA;;AAEA;;AAMA;;;;AAEA;;;;AAKA;AACA,IAAIA,iBAAiB,SAAjBA,cAAiB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACrC,MAAI;AACF,QAAIF,IAAIG,EAAJ,IAAU,IAAd,EAAoB;AAClBD,WAAKE,qBAAWC,0BAAX,EAAL;AACD;AACD,QAAIF,KAAKH,IAAIG,EAAb;;AAIAA,OAAGG,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtCA,iBAAWC,KAAX,CACE;;;;;;;;;;;;;;;;;;;0DADF,EAqBE,CAACT,IAAIS,KAAJ,CAAUC,UAAX,EAAsBV,IAAIS,KAAJ,CAAUE,UAAhC,CArBF,EAsBE,UAACJ,KAAD,EAAQK,MAAR,EAAmB;AACjB,wCAAoBT,EAApB,EAAwBK,UAAxB;AACA,YAAID,KAAJ,EAAW;AACTL,eAAKK,KAAL;AACD;AACDP,YAAIa,OAAJ,GAAcD,MAAd;AACAV;AACD,OA7BH;AA+BD,KAhCD;AAiCD,GAzCD,CAyCE,OAAOY,CAAP,EAAU;AACVZ,SAAKY,CAAL;AACD;AACF,CA7CH;;AA+CAC,OAAOC,OAAP,GAAiB;AACbjB;AADa,CAAjB","file":"ucaf.js","sourcesContent":["\"use strict\";\n\nimport {\n \n  \n  releaseDBConnection\n} from \"../utils\";\n\nimport httpStatus from \"../utils/httpStatus\";\n\nimport { debugLog } from \"../utils/logging\";\n\n\n\n\n//created by irfan: to get \nlet getPatientUCAF = (req, res, next) => {\n    try {\n      if (req.db == null) {\n        next(httpStatus.dataBaseNotInitilizedError());\n      }\n      let db = req.db;\n  \n      \n  \n      db.getConnection((error, connection) => {\n        connection.query(\n          \"select   hims_d_hospital_id,H.hospital_name,H.arabic_hospital_name,P.patient_code,P.full_name as patient_name,\\\n          P.arabic_name,P.marital_status,V.visit_date,V.visit_code, V.sub_department_id,SD.sub_department_name,\\\n          SD.arabic_sub_department_name,V.appointment_patient,V.new_visit_patient,V.doctor_id,E.full_name as doctor_name,\\\n          primary_insurance_provider_id as pri_TPA_id ,IP.insurance_provider_name as pri_TPA_company_name,\\\n          IM.primary_sub_id,SI.insurance_sub_name as pri_insurance_company,IM.primary_policy_num,IM.primary_inc_card_path,\\\n          IM.primary_network_id,NET.network_type as pri_plan_type,secondary_insurance_provider_id as sec_TPA_id,IPR.insurance_provider_name as sec_TPA_company_name ,\\\n          IM.secondary_sub_id,SIN.insurance_sub_name as sec_insurance_company,IM.secondary_policy_num,\\\n          IM.secondary_inc_card_path,IM.secondary_network_id,INET.network_type as sec_plan_type\\\n          from  hims_f_patient P inner join hims_f_patient_visit V on P.hims_d_patient_id=V.patient_id  and P.record_status='A'\\\n          inner join  hims_d_hospital H on V.hospital_id=H.hims_d_hospital_id and H.record_status='A'\\\n          inner join hims_d_sub_department SD on V.sub_department_id=SD.hims_d_sub_department_id and V.record_status='A' and SD.record_status='A'\\\n          inner join hims_d_employee E on E.hims_d_employee_id=V.doctor_id and E.record_status='A'\\\n          left join hims_m_patient_insurance_mapping IM on V.hims_f_patient_visit_id=IM.patient_visit_id  and IM.record_status='A'\\\n          left join hims_d_insurance_provider IP  on IM.primary_insurance_provider_id=IP.hims_d_insurance_provider_id  and IP.record_status='A'\\\n          left join hims_d_insurance_provider IPR  on IM.secondary_insurance_provider_id=IPR.hims_d_insurance_provider_id and IPR.record_status='A'\\\n          left join hims_d_insurance_sub SI on IM.primary_sub_id=SI.hims_d_insurance_sub_id and SI.record_status='A'\\\n          left join hims_d_insurance_sub SIN on IM.secondary_sub_id=SIN.hims_d_insurance_sub_id and SIN.record_status='A'\\\n          left join hims_d_insurance_network NET on IM.primary_network_id=NET.hims_d_insurance_network_id   and NET.record_status='A'\\\n          left join hims_d_insurance_network INET on IM.secondary_network_id=INET.hims_d_insurance_network_id   and INET.record_status='A'\\\n          where P.hims_d_patient_id=? and V.visit_date=?;\",\n          [req.query.patient_id,req.query.visit_date],\n          (error, result) => {\n            releaseDBConnection(db, connection);\n            if (error) {\n              next(error);\n            }\n            req.records = result;\n            next();\n          }\n        );\n      });\n    } catch (e) {\n      next(e);\n    }\n  };\n\nmodule.exports = { \n    getPatientUCAF    \n  };"]}