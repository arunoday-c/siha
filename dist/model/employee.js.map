{"version":3,"sources":["../../src/model/employee.js"],"names":["addEmployee","req","res","next","employeeModel","hims_d_employee_id","employee_code","first_name","middle_name","last_name","arabic_name","sex","date_of_birth","date_of_joining","date_of_leaving","address","primary_contact_no","secondary_contact_no","email","emergancy_contact_person","emergancy_contact_no","blood_group","employee_status","effective_start_date","effective_end_date","created_date","Date","created_by","userIdentity","algaeh_d_app_user_id","updated_date","updated_by","db","dataBaseNotInitilizedError","employeeDetails","body","getConnection","error","connection","query","result","resultBack","records","e","getEmployee","employeeWhereCondition","pagePaging","paging","Page","pageNo","page","pageSize","parameters","Wherecondition","condition","values","updateEmployee","module","exports"],"mappings":"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","file":"employee.js","sourcesContent":["import extend from \"extend\";\nimport {\n  selectStatement,\n  paging,\n  whereCondition,\n  releaseDBConnection\n} from \"../utils\";\nimport httpStatus from \"../utils/httpStatus\";\n\n// api to add employee\nlet addEmployee = (req, res, next) => {\n  let employeeModel = {\n    hims_d_employee_id: 0,\n    employee_code: null,\n    first_name: null,\n    middle_name: null,\n    last_name: null,\n    arabic_name: null,\n    sex: \"MALE\",\n    date_of_birth: null,\n    date_of_joining: null,\n    date_of_leaving: null,\n    address: null,\n    primary_contact_no: null,\n    secondary_contact_no: null,\n    email: null,\n    emergancy_contact_person: null,\n    emergancy_contact_no: null,\n    blood_group: null,\n    employee_status: \"A\",\n    effective_start_date: null,\n    effective_end_date: null,\n    created_date: new Date(),\n    created_by: req.userIdentity.algaeh_d_app_user_id,\n    updated_date: new Date(),\n    updated_by: req.userIdentity.algaeh_d_app_user_id\n  };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    let employeeDetails = extend(employeeModel, req.body);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n\n      connection.query(\n        \"INSERT hims_d_employee(employee_code,first_name,middle_name,last_name,arabic_name, \\\n            sex,date_of_birth,date_of_joining,date_of_leaving,address,primary_contact_no,\\\n            secondary_contact_no,email,emergancy_contact_person,emergancy_contact_no,\\\n            blood_group,effective_start_date,effective_end_date,created_date,created_by) \\\n            VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\",\n        [\n          employeeDetails.employee_code,\n          employeeDetails.first_name,\n          employeeDetails.middle_name,\n          employeeDetails.last_name,\n          employeeDetails.arabic_name,\n          employeeDetails.sex,\n          employeeDetails.date_of_birth,\n          employeeDetails.date_of_joining,\n          employeeDetails.date_of_leaving,\n          employeeDetails.address,\n          employeeDetails.primary_contact_no,\n          employeeDetails.secondary_contact_no,\n          employeeDetails.email,\n          employeeDetails.emergancy_contact_person,\n          employeeDetails.emergancy_contact_no,\n          employeeDetails.blood_group,\n          employeeDetails.effective_start_date,\n          employeeDetails.effective_end_date,\n          employeeDetails.created_date,\n          employeeDetails.created_by\n        ],\n        (error, result) => {\n          if (error) {\n            releaseDBConnection(db, connection);\n            next(error);\n          }\n\n          connection.query(\n            \"SELECT * FROM hims_d_employee WHERE hims_d_employee_id=?\",\n            [result[\"insertId\"]],\n            (error, resultBack) => {\n              releaseDBConnection(db, connection);\n              if (error) {\n                next(error);\n              }\n              req.records = resultBack;\n              next();\n            }\n          );\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\n// api to fetch employee\nlet getEmployee = (req, res, next) => {\n  let employeeWhereCondition = {\n    employee_code: \"ALL\",\n    first_name: \"ALL\",\n    middle_name: \"ALL\",\n    last_name: \"ALL\",\n    sex: \"ALL\",\n    blood_group: \"ALL\",\n    employee_status: \"ALL\",\n    date_of_joining: \"ALL\",\n    date_of_leaving: \"ALL\",\n    primary_contact_no: \"ALL\",\n    email: \"ALL\"\n  };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let pagePaging = \"\";\n    if (req.paging != null) {\n      let Page = paging(req.paging);\n      pagePaging += \" LIMIT \" + Page.pageNo + \",\" + page.pageSize;\n    }\n    let parameters = extend(\n      employeeWhereCondition,\n      req.Wherecondition == null ? {} : req.Wherecondition\n    );\n    let condition = whereCondition(extend(parameters, req.query));\n    selectStatement(\n      {\n        db: req.db,\n        query:\n          \"SELECT hims_d_employee_id \\\n        ,employee_code            \t\\\n        ,first_name               \t\\\n        ,middle_name              \t\\\n        ,last_name                \t\\\n        ,arabic_name \\\n        ,sex                      \t\\\n        ,date_of_birth            \t\\\n        ,date_of_joining          \t\\\n        ,date_of_leaving          \t\\\n        ,address                  \t\\\n        ,primary_contact_no       \t\\\n        ,secondary_contact_no     \t\\\n        ,email                    \t\\\n        ,emergancy_contact_person \t\\\n        ,emergancy_contact_no     \t\\\n        ,blood_group              \t\\\n        ,employee_status          \t\\\n        ,effective_start_date     \t\\\n        ,effective_end_date,CONCAT(first_name ,' ', middle_name,' ' ,last_name )as full_name FROM hims_d_employee WHERE record_status ='A' AND \" +\n          condition.condition +\n          \" \" +\n          pagePaging,\n        values: condition.values\n      },\n      result => {\n        req.records = result;\n        next();\n      },\n      error => {\n        next(error);\n      },\n      true\n    );\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet updateEmployee = (req, res, next) => {\n  let employeeModel = {\n    hims_d_employee_id: 0,\n    employee_code: null,\n    first_name: null,\n    middle_name: null,\n    last_name: null,\n    arabic_name: null,\n    sex: \"MALE\",\n    date_of_birth: null,\n    date_of_joining: null,\n    date_of_leaving: null,\n    address: null,\n    primary_contact_no: null,\n    secondary_contact_no: null,\n    email: null,\n    emergancy_contact_person: null,\n    emergancy_contact_no: null,\n    blood_group: null,\n    employee_status: \"A\",\n    effective_start_date: null,\n    effective_end_date: null,\n    created_date: new Date(),\n    created_by: req.userIdentity.algaeh_d_app_user_id,\n    updated_date: new Date(),\n    updated_by: req.userIdentity.algaeh_d_app_user_id\n  };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    let employeeDetails = extend(employeeModel, req.body);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.query(\n        \"UPDATE hims_d_employee SET first_name=?,middle_name=?\\\n                     ,last_name=?,arabic_name=?,sex=?,date_of_birth=?,date_of_joining=?\\\n                     ,date_of_leaving=?,address=?,primary_contact_no=?,secondary_contact_no=?\\\n                     ,email=?,emergancy_contact_person=?,emergancy_contact_no=?\\\n                     ,blood_group=?,employee_status=?,effective_start_date=?,effective_end_date=?\\\n                     ,updated_date=now(),updated_by=? WHERE  hims_d_employee_id=?\",\n        [\n          employeeDetails.first_name,\n          employeeDetails.middle_name,\n          employeeDetails.last_name,\n          employeeDetails.arabic_name,\n          employeeDetails.sex,\n          employeeDetails.date_of_birth,\n          employeeDetails.date_of_joining,\n          employeeDetails.date_of_leaving,\n          employeeDetails.address,\n          employeeDetails.primary_contact_no,\n          employeeDetails.secondary_contact_no,\n          employeeDetails.email,\n          employeeDetails.emergancy_contact_person,\n          employeeDetails.emergancy_contact_no,\n          employeeDetails.blood_group,\n          employeeDetails.employee_status,\n          employeeDetails.effective_start_date,\n          employeeDetails.effective_end_date,\n          employeeDetails.updated_by,\n          employeeDetails.hims_d_employee_id\n        ],\n        (error, result) => {\n          releaseDBConnection(db, connection);\n          if (error) {\n            next(error);\n          }\n          req.records = result;\n          next();\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\nmodule.exports = {\n  addEmployee,\n  getEmployee,\n  updateEmployee\n};\n"]}