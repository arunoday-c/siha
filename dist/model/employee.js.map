{"version":3,"sources":["../../src/model/employee.js"],"names":["addEmployee","req","res","next","db","dataBaseNotInitilizedError","input","body","getConnection","error","connection","beginTransaction","rollback","query","employee_code","title_id","first_name","middle_name","last_name","full_name","arabic_name","employee_designation_id","license_number","sex","date_of_birth","Date","date_of_joining","date_of_leaving","address","address2","pincode","city_id","state_id","country_id","primary_contact_no","secondary_contact_no","email","emergancy_contact_person","emergancy_contact_no","blood_group","isdoctor","employee_status","effective_start_date","effective_end_date","created_by","updated_by","result","insertId","deptDetails","length","insurtColumns","join","sampleInputObject","arrayObj","newFieldToInsert","departResult","resolve","reject","serviceComm","serviceCommResult","e","then","servTypeCommission","serviceTypeCommResult","commit","records","results","getEmployee","employeeWhereCondition","pagePaging","paging","Page","pageNo","page","pageSize","parameters","Wherecondition","condition","values","i","employee_id","hims_d_employee_id","updateEmployee","record_status","insertdeptDetails","insertDepartResult","updatedeptDetails","inputParam","qry","services_id","sub_department_id","category_speciality_id","user_id","toLocaleString","hims_d_employee_department_id","updateDeptDetailResult","insertserviceComm","updateserviceComm","provider_id","service_type_id","op_cash_commission_percent","op_credit_commission_percent","ip_cash_commission_percent","ip_credit_commission_percent","hims_m_doctor_service_commission_id","updateServiceCommResult","insertservTypeCommission","insrtServiceTypeCommResult","updateservTypeCommission","op_cash_comission_percent","op_credit_comission_percent","hims_m_doctor_service_type_commission_id","finally","getEmployeeDetails","where","getEmployeeCategory","speciality_id","getDoctorServiceCommission","getDoctorServiceTypeCommission","module","exports"],"mappings":"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","file":"employee.js","sourcesContent":["import extend from \"extend\";\r\nimport {\r\n  selectStatement,\r\n  paging,\r\n  whereCondition,\r\n  releaseDBConnection,\r\n  jsonArrayToObject\r\n} from \"../utils\";\r\nimport httpStatus from \"../utils/httpStatus\";\r\nimport moment from \"moment\";\r\nimport { logger, debugFunction, debugLog } from \"../utils/logging\";\r\nimport Promise from \"bluebird\";\r\n// api to add employee\r\nlet addEmployee = (req, res, next) => {\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let db = req.db;\r\n    let input = extend({}, req.body);\r\n    db.getConnection((error, connection) => {\r\n      if (error) {\r\n        next(error);\r\n      }\r\n\r\n      connection.beginTransaction(error => {\r\n        if (error) {\r\n          connection.rollback(() => {\r\n            releaseDBConnection(db, connection);\r\n            next(error);\r\n          });\r\n        }\r\n\r\n        connection.query(\r\n          \"INSERT hims_d_employee(employee_code,title_id,first_name,middle_name,last_name,\\\r\n          full_name,arabic_name,employee_designation_id,license_number,sex,date_of_birth,date_of_joining,date_of_leaving,address,\\\r\n          address2,pincode,city_id,state_id,country_id,primary_contact_no,secondary_contact_no,email,emergancy_contact_person,emergancy_contact_no,\\\r\n          blood_group,isdoctor,employee_status,effective_start_date,effective_end_date,created_date,created_by,updated_date,updated_by) values(\\\r\n            ?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\",\r\n          [\r\n            input.employee_code,\r\n            input.title_id,\r\n            input.first_name,\r\n            input.middle_name,\r\n            input.last_name,\r\n            input.full_name,\r\n            input.arabic_name,\r\n            input.employee_designation_id,\r\n            input.license_number,\r\n            input.sex,\r\n            input.date_of_birth != null\r\n              ? new Date(input.date_of_birth)\r\n              : input.date_of_birth,\r\n            input.date_of_joining,\r\n            input.date_of_leaving,\r\n            input.address,\r\n            input.address2,\r\n            input.pincode,\r\n            input.city_id,\r\n            input.state_id,\r\n            input.country_id,\r\n            input.primary_contact_no,\r\n            input.secondary_contact_no,\r\n            input.email,\r\n            input.emergancy_contact_person,\r\n            input.emergancy_contact_no,\r\n            input.blood_group,\r\n            input.isdoctor,\r\n            input.employee_status,\r\n            input.effective_start_date != null\r\n              ? new Date(input.effective_start_date)\r\n              : input.effective_start_date,\r\n            input.effective_end_date != null\r\n              ? new Date(input.effective_end_date)\r\n              : input.effective_end_date,\r\n            new Date(),\r\n            input.created_by,\r\n            new Date(),\r\n            input.updated_by\r\n          ],\r\n          (error, result) => {\r\n            if (error) {\r\n              connection.rollback(() => {\r\n                releaseDBConnection(db, connection);\r\n                next(error);\r\n              });\r\n            }\r\n            if (result.insertId != null && req.body.deptDetails.length > 0) {\r\n              const insurtColumns = [\r\n                \"services_id\",\r\n                \"sub_department_id\",\r\n                \"category_speciality_id\",\r\n                \"user_id\",\r\n                \"created_by\",\r\n                \"updated_by\"\r\n              ];\r\n\r\n              connection.query(\r\n                \"INSERT INTO hims_m_employee_department_mappings(\" +\r\n                  insurtColumns.join(\",\") +\r\n                  \",employee_id,created_date,updated_date) VALUES ?\",\r\n                [\r\n                  jsonArrayToObject({\r\n                    sampleInputObject: insurtColumns,\r\n                    arrayObj: req.body.deptDetails,\r\n                    newFieldToInsert: [result.insertId, new Date(), new Date()],\r\n                    req: req\r\n                  })\r\n                ],\r\n                (error, departResult) => {\r\n                  if (error) {\r\n                    connection.rollback(() => {\r\n                      releaseDBConnection(db, connection);\r\n                      next(error);\r\n                    });\r\n                  }\r\n\r\n                  new Promise((resolve, reject) => {\r\n                    try {\r\n                      if (input.serviceComm.length > 0) {\r\n                        const insurtColumns = [\r\n                          \"services_id\",\r\n                          \"service_type_id\",\r\n                          \"op_cash_commission_percent\",\r\n                          \"op_credit_commission_percent\",\r\n                          \"ip_cash_commission_percent\",\r\n                          \"ip_credit_commission_percent\",\r\n                          \"created_by\",\r\n                          \"updated_by\"\r\n                        ];\r\n\r\n                        connection.query(\r\n                          \"INSERT INTO hims_m_doctor_service_commission(\" +\r\n                            insurtColumns.join(\",\") +\r\n                            \",provider_id,created_date,updated_date) VALUES ?\",\r\n                          [\r\n                            jsonArrayToObject({\r\n                              sampleInputObject: insurtColumns,\r\n                              arrayObj: req.body.serviceComm,\r\n                              newFieldToInsert: [\r\n                                result.insertId,\r\n                                new Date(),\r\n                                new Date()\r\n                              ],\r\n                              req: req\r\n                            })\r\n                          ],\r\n                          (error, serviceCommResult) => {\r\n                            if (error) {\r\n                              connection.rollback(() => {\r\n                                releaseDBConnection(db, connection);\r\n                                next(error);\r\n                              });\r\n                            }\r\n                            return resolve(serviceCommResult);\r\n                          }\r\n                        );\r\n                      } else {\r\n                        return resolve(departResult);\r\n                      }\r\n                    } catch (e) {\r\n                      reject(e);\r\n                    }\r\n                  }).then(results => {\r\n                    if (input.servTypeCommission.length > 0) {\r\n                      const insurtColumns = [\r\n                        \"service_type_id\",\r\n                        \"op_cash_comission_percent\",\r\n                        \"op_credit_comission_percent\",\r\n                        \"ip_cash_commission_percent\",\r\n                        \"ip_credit_commission_percent\",\r\n                        \"created_by\",\r\n                        \"updated_by\"\r\n                      ];\r\n\r\n                      connection.query(\r\n                        \"INSERT INTO hims_m_doctor_service_type_commission(\" +\r\n                          insurtColumns.join(\",\") +\r\n                          \",provider_id,created_date,updated_date) VALUES ?\",\r\n                        [\r\n                          jsonArrayToObject({\r\n                            sampleInputObject: insurtColumns,\r\n                            arrayObj: req.body.servTypeCommission,\r\n                            newFieldToInsert: [\r\n                              result.insertId,\r\n                              new Date(),\r\n                              new Date()\r\n                            ],\r\n                            req: req\r\n                          })\r\n                        ],\r\n                        (error, serviceTypeCommResult) => {\r\n                          if (error) {\r\n                            connection.rollback(() => {\r\n                              releaseDBConnection(db, connection);\r\n                              next(error);\r\n                            });\r\n                          }\r\n\r\n                          connection.commit(error => {\r\n                            if (error) {\r\n                              connection.rollback(() => {\r\n                                releaseDBConnection(db, connection);\r\n                                next(error);\r\n                              });\r\n                            }\r\n                            releaseDBConnection(db, connection);\r\n                            req.records = serviceTypeCommResult;\r\n                            next();\r\n                          });\r\n                        }\r\n                      );\r\n                    } else {\r\n                      connection.commit(error => {\r\n                        if (error) {\r\n                          connection.rollback(() => {\r\n                            releaseDBConnection(db, connection);\r\n                            next(error);\r\n                          });\r\n                        }\r\n                        releaseDBConnection(db, connection);\r\n                        req.records = results;\r\n                        next();\r\n                      });\r\n                    }\r\n                  });\r\n                }\r\n              );\r\n            } else {\r\n              req.records = result;\r\n              releaseDBConnection(db, connection);\r\n              next();\r\n            }\r\n\r\n            // connection.query(\r\n            //   \"SELECT * FROM hims_d_employee WHERE hims_d_employee_id=?\",\r\n            //   [result[\"insertId\"]],\r\n            //   (error, resultBack) => {\r\n            //     releaseDBConnection(db, connection);\r\n            //     if (error) {\r\n            //       next(error);\r\n            //     }\r\n            //     req.records = resultBack;\r\n            //     next();\r\n            //   }\r\n            // );\r\n          }\r\n        );\r\n      });\r\n    });\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n// api to fetch employee\r\nlet getEmployee = (req, res, next) => {\r\n  let employeeWhereCondition = {\r\n    employee_code: \"ALL\",\r\n    first_name: \"ALL\",\r\n    middle_name: \"ALL\",\r\n    last_name: \"ALL\",\r\n    sex: \"ALL\",\r\n    blood_group: \"ALL\",\r\n    employee_status: \"ALL\",\r\n    date_of_joining: \"ALL\",\r\n    date_of_leaving: \"ALL\",\r\n    primary_contact_no: \"ALL\",\r\n    email: \"ALL\"\r\n  };\r\n\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let pagePaging = \"\";\r\n    if (req.paging != null) {\r\n      let Page = paging(req.paging);\r\n      pagePaging += \" LIMIT \" + Page.pageNo + \",\" + page.pageSize;\r\n    }\r\n    let parameters = extend(\r\n      employeeWhereCondition,\r\n      req.Wherecondition == null ? {} : req.Wherecondition\r\n    );\r\n    let condition = whereCondition(extend(parameters, req.query));\r\n    selectStatement(\r\n      {\r\n        db: req.db,\r\n        query:\r\n          \"SELECT * FROM hims_d_employee WHERE record_status ='A' AND \" +\r\n          condition.condition +\r\n          \" \" +\r\n          pagePaging,\r\n        values: condition.values\r\n      },\r\n      result => {\r\n        for (let i = 0; i < result.length; i++) {\r\n          result[i].employee_id = result[i].hims_d_employee_id;\r\n        }\r\n\r\n        req.records = result;\r\n        next();\r\n      },\r\n      error => {\r\n        next(error);\r\n      },\r\n      true\r\n    );\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n\r\n//created by irfan: to update Employee\r\nlet updateEmployee = (req, res, next) => {\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let db = req.db;\r\n    let input = extend({}, req.body);\r\n    db.getConnection((error, connection) => {\r\n      if (error) {\r\n        next(error);\r\n      }\r\n\r\n      connection.beginTransaction(error => {\r\n        if (error) {\r\n          connection.rollback(() => {\r\n            releaseDBConnection(db, connection);\r\n            next(error);\r\n          });\r\n        }\r\n\r\n        connection.query(\r\n          \"UPDATE hims_d_employee SET employee_code=?,title_id=?,first_name=?,middle_name=?,last_name=?,\\\r\n        full_name=?,arabic_name=?,employee_designation_id=?,license_number=?,sex=?,date_of_birth=?,date_of_joining=?\\\r\n        ,date_of_leaving=?,address=?,address2=?,pincode=?,city_id=?,state_id=?,country_id=?,primary_contact_no=?,\\\r\n        secondary_contact_no=?,email=?,emergancy_contact_person=?,emergancy_contact_no=?,blood_group=?,isdoctor=?,\\\r\n        employee_status=?,effective_start_date=?,effective_end_date=?,updated_date=?,updated_by=?,record_status=? WHERE record_status='A' and  hims_d_employee_id=?\",\r\n          [\r\n            input.employee_code,\r\n            input.title_id,\r\n            input.first_name,\r\n            input.middle_name,\r\n            input.last_name,\r\n            input.full_name,\r\n            input.arabic_name,\r\n            input.employee_designation_id,\r\n            input.license_number,\r\n            input.sex,\r\n            input.date_of_birth,\r\n            input.date_of_joining,\r\n            input.date_of_leaving,\r\n            input.address,\r\n            input.address2,\r\n            input.pincode,\r\n            input.city_id,\r\n            input.state_id,\r\n            input.country_id,\r\n            input.primary_contact_no,\r\n            input.secondary_contact_no,\r\n            input.email,\r\n            input.emergancy_contact_person,\r\n            input.emergancy_contact_no,\r\n            input.blood_group,\r\n            input.isdoctor,\r\n            input.employee_status,\r\n            input.effective_start_date,\r\n            input.effective_end_date,\r\n            new Date(),\r\n            input.updated_by,\r\n            input.record_status,\r\n            input.hims_d_employee_id\r\n          ],\r\n          (error, result) => {\r\n            if (error) {\r\n              connection.rollback(() => {\r\n                releaseDBConnection(db, connection);\r\n                next(error);\r\n              });\r\n            }\r\n            if (result.length != 0) {\r\n              return new Promise((resolve, reject) => {\r\n                if (input.insertdeptDetails.length > 0) {\r\n                  const insurtColumns = [\r\n                    \"employee_id\",\r\n                    \"services_id\",\r\n                    \"sub_department_id\",\r\n                    \"category_speciality_id\",\r\n                    \"user_id\",\r\n                    \"created_by\",\r\n                    \"updated_by\"\r\n                  ];\r\n\r\n                  connection.query(\r\n                    \"INSERT INTO hims_m_employee_department_mappings(\" +\r\n                      insurtColumns.join(\",\") +\r\n                      \",created_date,updated_date) VALUES ?\",\r\n                    [\r\n                      jsonArrayToObject({\r\n                        sampleInputObject: insurtColumns,\r\n                        arrayObj: req.body.insertdeptDetails,\r\n                        newFieldToInsert: [new Date(), new Date()],\r\n                        req: req\r\n                      })\r\n                    ],\r\n                    (error, insertDepartResult) => {\r\n                      if (error) {\r\n                        connection.rollback(() => {\r\n                          releaseDBConnection(db, connection);\r\n                          next(error);\r\n                        });\r\n                      }\r\n                      return resolve(insertDepartResult);\r\n                    }\r\n                  );\r\n                } else {\r\n                  resolve(result);\r\n                }\r\n              })\r\n                .then(resultFrmInsertDept => {\r\n                  debugLog(\"inside 1 then\");\r\n\r\n                  if (input.updatedeptDetails.length > 0) {\r\n                    debugLog(\"inside updatedeptDetails\");\r\n                    let inputParam = extend([], req.body.updatedeptDetails);\r\n                    let qry = \"\";\r\n\r\n                    for (\r\n                      let i = 0;\r\n                      i < req.body.updatedeptDetails.length;\r\n                      i++\r\n                    ) {\r\n                      qry +=\r\n                        \"UPDATE `hims_m_employee_department_mappings` SET employee_id='\" +\r\n                        inputParam[i].employee_id +\r\n                        \"', services_id='\" +\r\n                        inputParam[i].services_id +\r\n                        \"', sub_department_id='\" +\r\n                        inputParam[i].sub_department_id +\r\n                        \"', category_speciality_id='\" +\r\n                        inputParam[i].category_speciality_id +\r\n                        \"', user_id='\" +\r\n                        inputParam[i].user_id +\r\n                        \"', record_status='\" +\r\n                        inputParam[i].record_status +\r\n                        \"', updated_date='\" +\r\n                        new Date().toLocaleString() +\r\n                        \"',updated_by=\\\r\n'\" +\r\n                        req.body.updated_by +\r\n                        \"' WHERE record_status='A' and hims_d_employee_department_id='\" +\r\n                        inputParam[i].hims_d_employee_department_id +\r\n                        \"';\";\r\n                    }\r\n\r\n                    connection.query(qry, (error, updateDeptDetailResult) => {\r\n                      if (error) {\r\n                        connection.rollback(() => {\r\n                          releaseDBConnection(db, connection);\r\n                          next(error);\r\n                        });\r\n                      }\r\n                    });\r\n                  }\r\n                })\r\n                .then(updateDeptResult => {\r\n                  debugLog(\"inside 2 then\");\r\n\r\n                  if (input.insertserviceComm.length > 0) {\r\n                    debugLog(\"inside insertserviceComm\");\r\n                    const insurtColumns = [\r\n                      \"provider_id\",\r\n                      \"services_id\",\r\n                      \"service_type_id\",\r\n                      \"op_cash_commission_percent\",\r\n                      \"op_credit_commission_percent\",\r\n                      \"ip_cash_commission_percent\",\r\n                      \"ip_credit_commission_percent\",\r\n                      \"created_by\",\r\n                      \"updated_by\"\r\n                    ];\r\n\r\n                    connection.query(\r\n                      \"INSERT INTO hims_m_doctor_service_commission(\" +\r\n                        insurtColumns.join(\",\") +\r\n                        \",created_date,updated_date) VALUES ?\",\r\n                      [\r\n                        jsonArrayToObject({\r\n                          sampleInputObject: insurtColumns,\r\n                          arrayObj: req.body.insertserviceComm,\r\n                          newFieldToInsert: [new Date(), new Date()],\r\n                          req: req\r\n                        })\r\n                      ],\r\n                      (error, serviceCommResult) => {\r\n                        if (error) {\r\n                          connection.rollback(() => {\r\n                            releaseDBConnection(db, connection);\r\n                            next(error);\r\n                          });\r\n                        }\r\n                        //--\r\n                      }\r\n                    );\r\n                  }\r\n                })\r\n                .then(serviceCommResult => {\r\n                  debugLog(\"inside 3 then\");\r\n\r\n                  if (input.updateserviceComm.length > 0) {\r\n                    debugLog(\"inside updateserviceComm\");\r\n                    let inputParam = extend([], req.body.updateserviceComm);\r\n                    let qry = \"\";\r\n\r\n                    for (\r\n                      let i = 0;\r\n                      i < req.body.updateserviceComm.length;\r\n                      i++\r\n                    ) {\r\n                      qry +=\r\n                        \"UPDATE `hims_m_doctor_service_commission` SET provider_id='\" +\r\n                        inputParam[i].provider_id +\r\n                        \"', services_id='\" +\r\n                        inputParam[i].services_id +\r\n                        \"', service_type_id='\" +\r\n                        inputParam[i].service_type_id +\r\n                        \"', op_cash_commission_percent='\" +\r\n                        inputParam[i].op_cash_commission_percent +\r\n                        \"', op_credit_commission_percent='\" +\r\n                        inputParam[i].op_credit_commission_percent +\r\n                        \"', ip_cash_commission_percent='\" +\r\n                        inputParam[i].ip_cash_commission_percent +\r\n                        \"', ip_credit_commission_percent='\" +\r\n                        inputParam[i].ip_credit_commission_percent +\r\n                        \"', record_status='\" +\r\n                        inputParam[i].record_status +\r\n                        \"', updated_date='\" +\r\n                        new Date().toLocaleString() +\r\n                        \"',updated_by=\\\r\n'\" +\r\n                        req.body.updated_by +\r\n                        \"' WHERE record_status='A' and hims_m_doctor_service_commission_id='\" +\r\n                        inputParam[i].hims_m_doctor_service_commission_id +\r\n                        \"';\";\r\n                    }\r\n\r\n                    connection.query(qry, (error, updateServiceCommResult) => {\r\n                      if (error) {\r\n                        connection.rollback(() => {\r\n                          releaseDBConnection(db, connection);\r\n                          next(error);\r\n                        });\r\n                      }\r\n                    });\r\n                  }\r\n                })\r\n                .then(updateServiceCommResult => {\r\n                  debugLog(\"inside 4 then\");\r\n                  if (input.insertservTypeCommission.length > 0) {\r\n                    debugLog(\"inside insertservTypeCommission\");\r\n                    const insurtColumns = [\r\n                      \"provider_id\",\r\n                      \"service_type_id\",\r\n                      \"op_cash_comission_percent\",\r\n                      \"op_credit_comission_percent\",\r\n                      \"ip_cash_commission_percent\",\r\n                      \"ip_credit_commission_percent\",\r\n                      \"created_by\",\r\n                      \"updated_by\"\r\n                    ];\r\n\r\n                    connection.query(\r\n                      \"INSERT INTO hims_m_doctor_service_type_commission(\" +\r\n                        insurtColumns.join(\",\") +\r\n                        \",created_date,updated_date) VALUES ?\",\r\n                      [\r\n                        jsonArrayToObject({\r\n                          sampleInputObject: insurtColumns,\r\n                          arrayObj: req.body.insertservTypeCommission,\r\n                          newFieldToInsert: [new Date(), new Date()],\r\n                          req: req\r\n                        })\r\n                      ],\r\n                      (error, insrtServiceTypeCommResult) => {\r\n                        if (error) {\r\n                          connection.rollback(() => {\r\n                            releaseDBConnection(db, connection);\r\n                            next(error);\r\n                          });\r\n                        }\r\n                        //-\r\n                      }\r\n                    );\r\n                  }\r\n                })\r\n                .then(insrtServiceTypeCommResult => {\r\n                  debugLog(\"inside 5 then\");\r\n                  if (input.updateservTypeCommission.length > 0) {\r\n                    debugLog(\"inside updateservTypeCommission\");\r\n                    let inputParam = extend(\r\n                      [],\r\n                      req.body.updateservTypeCommission\r\n                    );\r\n                    let qry = \"\";\r\n\r\n                    for (\r\n                      let i = 0;\r\n                      i < req.body.updateservTypeCommission.length;\r\n                      i++\r\n                    ) {\r\n                      qry +=\r\n                        \"UPDATE `hims_m_doctor_service_type_commission` SET provider_id='\" +\r\n                        inputParam[i].provider_id +\r\n                        \"', service_type_id='\" +\r\n                        inputParam[i].service_type_id +\r\n                        \"', op_cash_comission_percent='\" +\r\n                        inputParam[i].op_cash_comission_percent +\r\n                        \"', op_credit_comission_percent='\" +\r\n                        inputParam[i].op_credit_comission_percent +\r\n                        \"', ip_cash_commission_percent='\" +\r\n                        inputParam[i].ip_cash_commission_percent +\r\n                        \"', ip_credit_commission_percent='\" +\r\n                        inputParam[i].ip_credit_commission_percent +\r\n                        \"', record_status='\" +\r\n                        inputParam[i].record_status +\r\n                        \"', updated_date='\" +\r\n                        new Date().toLocaleString() +\r\n                        \"',updated_by=\\\r\n'\" +\r\n                        req.body.updated_by +\r\n                        \"' WHERE record_status='A' and hims_m_doctor_service_type_commission_id='\" +\r\n                        inputParam[i].hims_m_doctor_service_type_commission_id +\r\n                        \"';\";\r\n                    }\r\n\r\n                    connection.query(qry, (error, updateServiceCommResult) => {\r\n                      if (error) {\r\n                        connection.rollback(() => {\r\n                          releaseDBConnection(db, connection);\r\n                          next(error);\r\n                        });\r\n                      }\r\n                    });\r\n                  }\r\n                })\r\n\r\n                .finally(allResult => {\r\n                  debugLog(\"inside finally\");\r\n                  connection.commit(error => {\r\n                    if (error) {\r\n                      connection.rollback(() => {\r\n                        releaseDBConnection(db, connection);\r\n                        next(error);\r\n                      });\r\n                    }\r\n                    releaseDBConnection(db, connection);\r\n                    req.records = result;\r\n                    next();\r\n                  });\r\n                });\r\n            } else {\r\n              req.records = result;\r\n              releaseDBConnection(db, connection);\r\n              next();\r\n            }\r\n          }\r\n        );\r\n      });\r\n    });\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n\r\n//created by irfan: to get eployee details\r\nlet getEmployeeDetails = (req, res, next) => {\r\n  let employeeWhereCondition = {\r\n    employee_code: \"ALL\",\r\n    first_name: \"ALL\",\r\n    middle_name: \"ALL\",\r\n    last_name: \"ALL\",\r\n    sex: \"ALL\",\r\n    blood_group: \"ALL\",\r\n    employee_status: \"ALL\",\r\n    date_of_joining: \"ALL\",\r\n    date_of_leaving: \"ALL\",\r\n    primary_contact_no: \"ALL\",\r\n    email: \"ALL\"\r\n  };\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let db = req.db;\r\n\r\n    let where = whereCondition(extend(employeeWhereCondition, req.query));\r\n\r\n    db.getConnection((error, connection) => {\r\n      connection.query(\r\n        \"SELECT E.hims_d_employee_id,E.employee_code,E.title_id,E.first_name,E.middle_name,E.last_name,E.full_name,E.arabic_name,E.employee_designation_id,\\\r\n        E.license_number,E.sex,E.date_of_birth,E.date_of_joining,E.date_of_leaving,E.address,E.address2,E.pincode,E.city_id,E.state_id,E.country_id,E.primary_contact_no,\\\r\n        E.secondary_contact_no,E.email,E.emergancy_contact_person,E.emergancy_contact_no,E.blood_group,\\\r\n        E.isdoctor,E.employee_status,E.effective_start_date,E.effective_end_date,\\\r\n        ED.hims_d_employee_department_id,ED.employee_id,ED.sub_department_id,ED.category_speciality_id,ED.user_id, ED.services_id,CS.hims_m_category_speciality_mappings_id,CS.category_id,CS.speciality_id,\\\r\n        CS.category_speciality_status,CS.effective_start_date,CS.effective_end_date\\\r\n        from hims_d_employee E,hims_m_employee_department_mappings ED,hims_m_category_speciality_mappings CS\\\r\n         Where E.record_status='A' and ED.record_status='A' and CS.record_status='A' and E.hims_d_employee_id=ED.employee_id and ED.category_speciality_id=CS.hims_m_category_speciality_mappings_id AND \" +\r\n          where.condition,\r\n        where.values,\r\n        (error, result) => {\r\n          releaseDBConnection(db, connection);\r\n          if (error) {\r\n            next(error);\r\n          }\r\n          req.records = result;\r\n          next();\r\n        }\r\n      );\r\n    });\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n\r\n//created by irfan: to get eployee details\r\nlet getEmployeeCategory = (req, res, next) => {\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let db = req.db;\r\n\r\n    db.getConnection((error, connection) => {\r\n      connection.query(\r\n        \"select hims_m_category_speciality_mappings_id, category_id, speciality_id ,C.hims_employee_category_id,C.employee_category_code,C.employee_category_name,\\\r\n        C.employee_category_desc from hims_m_category_speciality_mappings CS,hims_d_employee_category C\\\r\n         where CS.record_status='A' and C.record_status='A' and  CS.category_id=C.hims_employee_category_id and speciality_id=?\",\r\n        [req.query.speciality_id],\r\n        (error, result) => {\r\n          releaseDBConnection(db, connection);\r\n          if (error) {\r\n            next(error);\r\n          }\r\n          req.records = result;\r\n          next();\r\n        }\r\n      );\r\n    });\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n\r\n//created by irfan: to get Doctor Service Commission\r\nlet getDoctorServiceCommission = (req, res, next) => {\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let db = req.db;\r\n\r\n    let input = extend({}, req.query);\r\n\r\n    db.getConnection((error, connection) => {\r\n      connection.query(\r\n        \"select hims_m_doctor_service_commission_id,provider_id,services_id,service_type_id,op_cash_commission_percent,\\\r\n        op_credit_commission_percent,ip_cash_commission_percent,ip_credit_commission_percent\\\r\n         from hims_m_doctor_service_commission where record_status='A'and provider_id=?\",\r\n        [input.provider_id],\r\n        (error, result) => {\r\n          releaseDBConnection(db, connection);\r\n          if (error) {\r\n            next(error);\r\n          }\r\n          req.records = result;\r\n          next();\r\n        }\r\n      );\r\n    });\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n\r\n//created by irfan: to get Doctor Service  type Commission\r\nlet getDoctorServiceTypeCommission = (req, res, next) => {\r\n  try {\r\n    if (req.db == null) {\r\n      next(httpStatus.dataBaseNotInitilizedError());\r\n    }\r\n    let db = req.db;\r\n\r\n    let input = extend({}, req.query);\r\n\r\n    db.getConnection((error, connection) => {\r\n      connection.query(\r\n        \"select hims_m_doctor_service_type_commission_id,provider_id,service_type_id,\\\r\n        op_cash_comission_percent,op_credit_comission_percent,ip_cash_commission_percent,ip_credit_commission_percent\\\r\n         from hims_m_doctor_service_type_commission where record_status='A' and provider_id=?\",\r\n        [input.provider_id],\r\n        (error, result) => {\r\n          releaseDBConnection(db, connection);\r\n          if (error) {\r\n            next(error);\r\n          }\r\n          req.records = result;\r\n          next();\r\n        }\r\n      );\r\n    });\r\n  } catch (e) {\r\n    next(e);\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  addEmployee,\r\n  getEmployee,\r\n  updateEmployee,\r\n  getEmployeeDetails,\r\n  getEmployeeCategory,\r\n  getDoctorServiceCommission,\r\n  getDoctorServiceTypeCommission\r\n};\r\n"]}