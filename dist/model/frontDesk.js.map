{"version":3,"sources":["../../src/model/frontDesk.js"],"names":["requestCounter","addFrontDesk","req","res","next","db","dataBaseNotInitilizedError","query","JSON","parse","body","getConnection","error","connection","beginTransaction","rollback","resolve","reject","counter","module_desc","onFailure","onSuccess","result","then","patients","output","Where","w","FirstOrDefault","patient_code","completeNumber","options","visit","patientInsertedRecord","visit_code","visit_id","visitData","patient_visit_id","insured","data","bill","bill_number","billing_header_id","billOutput","insertId","receipt","receipt_number","records","commit","encounterResult","catch","e","selectFrontDesk","selectWhere","hims_d_patient_id","where","condition","values","showresult","length","resultFields","patientRegistration","visitDetails","updateCounter","updateFrontDesk","module","exports"],"mappings":"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D,KA/JD;AAgKD,GA1KD,CA0KE,OAAOuC,CAAP,EAAU;AACV/C,SAAK+C,CAAL;AACD;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,CA5UD;;AA8UAc,OAAOC,OAAP,GAAiB;AACfjE,4BADe;AAEfmD,kCAFe;AAGfY;AAHe,CAAjB","file":"frontDesk.js","sourcesContent":["import { insertData, insertPatientData } from \"../model/patientRegistration\";\nimport { insertVisitData, insertPatientVisitData } from \"../model/visit\";\nimport {\n  whereCondition,\n  runningNumber,\n  runningNumberGen,\n  releaseDBConnection\n} from \"../utils\";\nimport extend from \"extend\";\nimport {\n  addBill,\n  newReceipt,\n  addEpisodeEncounter,\n  addBillData,\n  newReceiptData,\n  addEpisodeEncounterData\n} from \"../model/billing\";\nimport {\n  addPatientInsurance,\n  addPatientInsuranceData\n} from \"../model/insurance\";\nimport httpStatus from \"../utils/httpStatus\";\nimport { debugLog, debugFunction } from \"../utils/logging\";\nimport Promise from \"bluebird\";\nimport { LINQ } from \"node-linq\";\nlet requestCounter = 0;\n//created by irfan :to save front desk data inputs\nlet addFrontDesk = (req, res, next) => {\n  debugFunction(\"addFrontDesk\");\n\n  requestCounter = requestCounter + 1;\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    if (req.query[\"data\"] != null) {\n      req.query = JSON.parse(req.query[\"data\"]);\n      req.body = req.query;\n    }\n\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.beginTransaction(error => {\n        if (error) {\n          connection.rollback(() => {\n            releaseDBConnection(db, connection);\n            next(error);\n          });\n        }\n        return new Promise((resolve, reject) => {\n          runningNumberGen({\n            db: connection,\n            counter: requestCounter,\n            module_desc: [\"PAT_REGS\", \"PAT_VISIT\", \"PAT_BILL\", \"RECEIPT\"],\n            onFailure: error => {\n              reject(error);\n            },\n            onSuccess: result => {\n              resolve(result);\n            }\n          });\n        })\n          .then(output => {\n            //Calling Patient Registration function\n            let patients = new LINQ(output)\n              .Where(w => w.module_desc == \"PAT_REGS\")\n              .FirstOrDefault();\n\n            req.query.patient_code = patients.completeNumber;\n            req.body.patient_code = patients.completeNumber;\n            return new Promise((resolve, reject) => {\n              req.options = {\n                db: connection,\n                onFailure: error => {\n                  reject(error);\n                },\n                onSuccess: result => {\n                  resolve(result);\n                }\n              };\n              insertPatientData(req, res, next);\n            })\n              .then(patientInsertedRecord => {\n                //Get  new visit running number.\n                let visit = new LINQ(output)\n                  .Where(w => w.module_desc == \"PAT_VISIT\")\n                  .FirstOrDefault();\n                debugLog(\"patientInsertedRecord \", patientInsertedRecord);\n\n                req.query.visit_code = visit.completeNumber;\n                req.body.visit_code = visit.completeNumber;\n                delete req[\"options\"][\"onFailure\"];\n                delete req[\"options\"][\"onSuccess\"];\n                //Visit Promise\n                return new Promise((resolve, reject) => {\n                  debugLog(\"Inside Visit\");\n                  req.options.onFailure = error => {\n                    reject(error);\n                  };\n                  req.options.onSuccess = result => {\n                    resolve(result);\n                  };\n                  // Calling Visit\n                  insertPatientVisitData(req, res, next);\n                }).then(visitData => {\n                  req.query.visit_id = visitData[\"insertId\"];\n                  req.visit_id = visitData[\"insertId\"];\n                  req.body.visit_id = visitData[\"insertId\"];\n                  req.body.patient_visit_id = visitData[\"insertId\"];\n                  debugLog(\"Gen Visit \", visitData);\n                  //Insurance Promise\n                  return new Promise((resolve, reject) => {\n                    debugLog(\"Inside Insurance\");\n                    if (req.body.insured == \"Y\") {\n                      delete req[\"options\"][\"onFailure\"];\n                      delete req[\"options\"][\"onSuccess\"];\n                      req.options.onFailure = error => {\n                        reject(error);\n                      };\n                      req.options.onSuccess = data => {\n                        resolve(data);\n                      };\n                      //Check for insurace\n                      addPatientInsuranceData(req, res, next);\n                    } else {\n                      resolve({});\n                    }\n                  }).then(insuredRecords => {\n                    debugLog(\"Orver all records number gen\", output);\n                    let bill = new LINQ(output)\n                      .Where(w => w.module_desc == \"PAT_BILL\")\n                      .FirstOrDefault();\n                    req.bill_number = bill.completeNumber;\n                    req.body.bill_number = bill.completeNumber;\n                    //Bill generation\n                    return new Promise((resolve, reject) => {\n                      debugLog(\"Inside Billing\");\n                      delete req[\"options\"][\"onFailure\"];\n                      delete req[\"options\"][\"onSuccess\"];\n                      req.options.onFailure = error => {\n                        reject(error);\n                      };\n                      req.options.onSuccess = data => {\n                        resolve(data);\n                      };\n\n                      addBillData(req, res, next);\n                    }).then(billOutput => {\n                      req.query.billing_header_id = billOutput.insertId;\n                      req.body.billing_header_id = billOutput.insertId;\n\n                      let receipt = new LINQ(output)\n                        .Where(w => w.module_desc == \"RECEIPT\")\n                        .FirstOrDefault();\n                      req.body.receipt_number = receipt.completeNumber;\n                      return new Promise((resolve, reject) => {\n                        debugLog(\"Inside Receipts\");\n                        delete req[\"options\"][\"onFailure\"];\n                        delete req[\"options\"][\"onSuccess\"];\n                        req.options.onFailure = error => {\n                          reject(error);\n                        };\n                        req.options.onSuccess = records => {\n                          resolve(records);\n                        };\n                        newReceiptData(req, res, next);\n                      }).then(records => {\n                        return new Promise((resolve, reject) => {\n                          debugLog(\"Inside Episode\");\n                          delete req[\"options\"][\"onFailure\"];\n                          delete req[\"options\"][\"onSuccess\"];\n                          req.options.onFailure = error => {\n                            reject(error);\n                          };\n                          req.options.onSuccess = records => {\n                            resolve(records);\n                          };\n                          debugLog(\"Visit\", records);\n                          addEpisodeEncounterData(req, res, next);\n                        }).then(encounterResult => {\n                          connection.commit(error => {\n                            debugLog(\"After Episode Error: \", error);\n                            if (error) {\n                              debugLog(\"Error: \", error);\n                              releaseDBConnection(db, connection);\n                              next(error);\n                            }\n                            req.records = encounterResult;\n                            debugLog(\"encounterResult: \", encounterResult);\n                            if (requestCounter != 0)\n                              requestCounter = requestCounter - 1;\n                            next();\n                          });\n                        });\n                      });\n                    });\n                  });\n                });\n              })\n              .catch(error => {\n                if (requestCounter != 0) requestCounter = requestCounter - 1;\n                connection.rollback(() => {\n                  releaseDBConnection(db, connection);\n                  next(error);\n                });\n              });\n          })\n          .catch(error => {\n            if (requestCounter != 0) requestCounter = requestCounter - 1;\n            connection.rollback(() => {\n              releaseDBConnection(db, connection);\n              next(error);\n            });\n          });\n      });\n      //bign tr\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet selectFrontDesk = (req, res, next) => {\n  let selectWhere = {\n    patient_code: \"ALL\",\n    hims_d_patient_id: \"ALL\"\n  };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      let where = whereCondition(extend(selectWhere, req.query));\n      connection.query(\n        \"SELECT  `hims_d_patient_id`, `patient_code`\\\n      , `registration_date`, `title_id`,`first_name`, `middle_name`, `last_name`,`full_name`, `arabic_name`\\\n      , `gender`, `religion_id`,`date_of_birth`, `age`, `marital_status`, `address1`\\\n      , `address2`,`contact_number`, `secondary_contact_number`, `email`\\\n      , `emergency_contact_name`,`emergency_contact_number`, `relationship_with_patient`\\\n      , `visa_type_id`,`nationality_id`, `postal_code`, `primary_identity_id`\\\n      , `primary_id_no`,`secondary_identity_id`, `secondary_id_no`, `photo_file`\\\n      , `primary_id_file`,`secondary_id_file`,`city_id`,`state_id`,`country_id`, `advance_amount`,`patient_type` FROM `hims_f_patient` \\\n       WHERE `record_status`='A' AND \" +\n          where.condition,\n        where.values,\n        (error, result) => {\n          if (error) {\n            releaseDBConnection(db, connection);\n            next(error);\n          }\n          let showresult;\n          if (result.length != 0) {\n            let hims_d_patient_id = result[0][\"hims_d_patient_id\"];\n            connection.query(\n              \"SELECT 0 radioselect, `hims_f_patient_visit_id`, `patient_id`,`visit_code`\\\n            , `visit_type`, `visit_date`, `department_id`, `sub_department_id`\\\n            , `doctor_id`, `maternity_patient`, `is_mlc`, `mlc_accident_reg_no`\\\n            , `mlc_police_station`, `mlc_wound_certified_date`, `insured`, `sec_insured`\\\n             FROM `hims_f_patient_visit` WHERE `record_status`='A' AND \\\n             patient_id=? ORDER BY hims_f_patient_visit_id desc \",\n              [hims_d_patient_id],\n              (error, resultFields) => {\n                if (error) {\n                  releaseDBConnection(db, connection);\n                  next(error);\n                }\n                showresult = {\n                  patientRegistration: result[0],\n                  visitDetails: resultFields\n                };\n                req.records = showresult;\n                next();\n              }\n            );\n          } else {\n            req.records = showresult;\n            next();\n          }\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet updateCounter = 0;\n//created by irfan :to update front desk\nlet updateFrontDesk = (req, res, next) => {\n  debugFunction(\"updateFrontDesk\");\n\n  updateCounter = updateCounter + 1;\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    if (req.query[\"data\"] != null) {\n      req.query = JSON.parse(req.query[\"data\"]);\n      req.body = req.query;\n    }\n\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.beginTransaction(error => {\n        if (error) {\n          connection.rollback(() => {\n            releaseDBConnection(db, connection);\n            next(error);\n          });\n        }\n        debugFunction(\"updateFrontDesk Promise\");\n        return new Promise((resolve, reject) => {\n          runningNumberGen({\n            db: connection,\n            counter: updateCounter,\n            module_desc: [\"PAT_VISIT\", \"PAT_BILL\", \"RECEIPT\"],\n            onFailure: error => {\n              reject(error);\n            },\n            onSuccess: result => {\n              resolve(result);\n            }\n          });\n        })\n          .then(output => {\n            //Get  new visit running number.\n\n            let visit = new LINQ(output)\n              .Where(w => w.module_desc == \"PAT_VISIT\")\n              .FirstOrDefault();\n            debugLog(\"patientInsertedRecord \", visit);\n\n            req.query.visit_code = visit.completeNumber;\n            req.body.visit_code = visit.completeNumber;\n\n            //Visit Promise\n            return new Promise((resolve, reject) => {\n              debugLog(\"Inside Visit\");\n\n              req.options = {\n                db: connection,\n                onFailure: error => {\n                  reject(error);\n                },\n                onSuccess: result => {\n                  resolve(result);\n                }\n              };\n              debugLog(\"Inside Conn\");\n              // req.options.onFailure = error => {\n              //   reject(error);\n              // };\n              // req.options.onSuccess = result => {\n              //   resolve(result);\n              // };\n              // Calling Visit\n              insertPatientVisitData(req, res, next);\n            }).then(visitData => {\n              req.query.visit_id = visitData[\"insertId\"];\n              req.visit_id = visitData[\"insertId\"];\n              req.body.visit_id = visitData[\"insertId\"];\n              req.body.patient_visit_id = visitData[\"insertId\"];\n              debugLog(\"Gen Visit \", visitData);\n              //Insurance Promise\n              return new Promise((resolve, reject) => {\n                debugLog(\"Inside Insurance\");\n                if (req.body.insured == \"Y\") {\n                  delete req[\"options\"][\"onFailure\"];\n                  delete req[\"options\"][\"onSuccess\"];\n                  req.options.onFailure = error => {\n                    reject(error);\n                  };\n                  req.options.onSuccess = data => {\n                    resolve(data);\n                  };\n                  //Check for insurace\n                  addPatientInsuranceData(req, res, next);\n                } else {\n                  resolve({});\n                }\n              }).then(insuredRecords => {\n                debugLog(\"Orver all records number gen\", output);\n                let bill = new LINQ(output)\n                  .Where(w => w.module_desc == \"PAT_BILL\")\n                  .FirstOrDefault();\n                req.bill_number = bill.completeNumber;\n                req.body.bill_number = bill.completeNumber;\n                //Bill generation\n                return new Promise((resolve, reject) => {\n                  debugLog(\"Inside Billing\");\n                  delete req[\"options\"][\"onFailure\"];\n                  delete req[\"options\"][\"onSuccess\"];\n                  req.options.onFailure = error => {\n                    reject(error);\n                  };\n                  req.options.onSuccess = data => {\n                    resolve(data);\n                  };\n\n                  addBillData(req, res, next);\n                }).then(billOutput => {\n                  req.query.billing_header_id = billOutput.insertId;\n                  req.body.billing_header_id = billOutput.insertId;\n\n                  let receipt = new LINQ(output)\n                    .Where(w => w.module_desc == \"RECEIPT\")\n                    .FirstOrDefault();\n                  req.body.receipt_number = receipt.completeNumber;\n                  return new Promise((resolve, reject) => {\n                    debugLog(\"Inside Receipts\");\n                    delete req[\"options\"][\"onFailure\"];\n                    delete req[\"options\"][\"onSuccess\"];\n                    req.options.onFailure = error => {\n                      reject(error);\n                    };\n                    req.options.onSuccess = records => {\n                      resolve(records);\n                    };\n                    newReceiptData(req, res, next);\n                  }).then(records => {\n                    return new Promise((resolve, reject) => {\n                      debugLog(\"Inside Episode\");\n                      delete req[\"options\"][\"onFailure\"];\n                      delete req[\"options\"][\"onSuccess\"];\n                      req.options.onFailure = error => {\n                        reject(error);\n                      };\n                      req.options.onSuccess = records => {\n                        resolve(records);\n                      };\n                      debugLog(\"Before Episode\");\n                      addEpisodeEncounterData(req, res, next);\n                      debugLog(\"After Episode\");\n                    }).then(encounterResult => {\n                      connection.commit(error => {\n                        if (error) {\n                          releaseDBConnection(db, connection);\n                          next(error);\n                        }\n                        req.records = encounterResult;\n                        if (updateCounter != 0)\n                          updateCounter = updateCounter - 1;\n                        next();\n                      });\n                    });\n                  });\n                });\n              });\n            });\n          })\n          .catch(error => {\n            if (updateCounter != 0) updateCounter = updateCounter - 1;\n            connection.rollback(() => {\n              releaseDBConnection(db, connection);\n              next(error);\n            });\n          });\n      });\n    });\n  } catch (e) {\n    next(e);\n  }\n  // debugFunction(\"updateFrontDesk\");\n\n  // try {\n  //   if (req.db == null) {\n  //     next(httpStatus.dataBaseNotInitilizedError());\n  //   }\n  //   let db = req.db;\n  //   if (req.query[\"data\"] != null) {\n  //     req.query = JSON.parse(req.query[\"data\"]);\n  //     req.body = req.query;\n  //   }\n\n  //   db.getConnection((error, connection) => {\n  //     if (error) {\n  //       next(error);\n  //     }\n  //     connection.beginTransaction(error => {\n  //       if (error) {\n  //         connection.rollback(() => {\n  //           releaseDBConnection(db, connection);\n  //           next(error);\n  //         });\n  //       }\n  //       //Front Desk updation\n\n  //       //Visit Insertion for update front desk API\n  //       //query 1\n  //       runningNumber(\n  //         req.db,\n  //         2,\n  //         \"VISIT_NUMGEN\",\n  //         (error, patResults, completeNum) => {\n  //           if (error) {\n  //             connection.rollback(() => {\n  //               releaseDBConnection(db, connection);\n  //               next(error);\n  //             });\n  //           }\n  //           req.query.visit_code = completeNum;\n  //           req.body.visit_code = completeNum;\n  //           debugLog(\"req.body.visit_code : \" + completeNum);\n\n  //           //call\n  //           insertVisitData(\n  //             connection,\n  //             req,\n  //             res,\n  //             (error, resultdata) => {\n  //               if (error) {\n  //                 connection.rollback(() => {\n  //                   releaseDBConnection(db, connection);\n  //                   next(error);\n  //                 });\n  //               }\n\n  //               //Billing Insertion for update front desk APi\n  //               //Quwery:2\n  //               if (resultdata != null && resultdata.length != 0) {\n  //                 req.query.visit_id = resultdata[\"insertId\"];\n  //                 req.body.visit_id = resultdata[\"insertId\"];\n  //                 req.body.patient_visit_id = resultdata[\"insertId\"];\n  //                 debugLog(\"req.body.visit_id:\" + resultdata[\"insertId\"]);\n\n  //                 debugLog(\" result of visit func\", resultdata);\n\n  //                 //add patient insurance\n\n  //                 if (req.body.insured == \"Y\") {\n  //                   addPatientInsurance(\n  //                     connection,\n  //                     req,\n  //                     res,\n  //                     (error, result) => {\n  //                       if (error) {\n  //                         debugLog(\"error in adding insurence\", error);\n  //                         connection.rollback(() => {\n  //                           releaseDBConnection(db, connection);\n  //                           next(error);\n  //                         });\n  //                       }\n\n  //                       debugLog(\"add insuence result:\", result);\n  //                     }\n  //                   );\n  //                 }\n\n  //                 //call\n  //                 addBill(\n  //                   connection,\n  //                   req,\n  //                   res,\n  //                   (error, result) => {\n  //                     if (error) {\n  //                       connection.rollback(() => {\n  //                         releaseDBConnection(db, connection);\n  //                         next(error);\n  //                       });\n  //                     }\n\n  //                     //Query :3\n  //                     //insert receipt for update front desk api\n\n  //                     if (result != null && result.length != 0) {\n  //                       req.query.billing_header_id = result.insertId;\n  //                       req.body.billing_header_id = result.insertId;\n\n  //                       debugLog(\n  //                         \"  req.body.billing_header_id:\" + result[\"insertId\"]\n  //                       );\n\n  //                       //call\n\n  //                       newReceipt(\n  //                         connection,\n  //                         req,\n  //                         res,\n  //                         (error, resultdata) => {\n  //                           if (error) {\n  //                             connection.rollback(() => {\n  //                               releaseDBConnection(db, connection);\n  //                               next(error);\n  //                             });\n  //                           }\n  //                           connection.commit(error => {\n  //                             releaseDBConnection(db, connection);\n  //                             if (error) {\n  //                               connection.rollback(() => {\n  //                                 next(error);\n  //                               });\n  //                             }\n  //                             req.records = result;\n  //                             next();\n  //                           });\n\n  //                           debugLog(\"succes result of query 3 : \", resultdata);\n  //                         },\n  //                         next\n  //                       );\n  //                     }\n  //                   },\n\n  //                   next\n  //                 );\n  //               }\n  //             },\n  //             true,\n  //             next\n  //           );\n  //         }\n  //       );\n  //     });\n  //   });\n  // } catch (e) {\n  //   next(e);\n  // }\n};\n\nmodule.exports = {\n  addFrontDesk,\n  selectFrontDesk,\n  updateFrontDesk\n};\n"]}