{"version":3,"sources":["../../src/model/frontDesk.js"],"names":["addFrontDesk","req","res","next","db","dataBaseNotInitilizedError","query","JSON","parse","body","getConnection","error","connection","beginTransaction","rollback","records","newNumber","length","patient_code","result","patient_id","patResults","completeNum","visit_code","resultdata","visit_id","billing_header_id","insertId","commit","e","selectFrontDesk","selectWhere","hims_d_patient_id","where","condition","values","showresult","resultFields","patientRegistration","visitDetails","updateFrontDesk","module","exports"],"mappings":"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","file":"frontDesk.js","sourcesContent":["import { insertData } from \"../model/patientRegistration\";\nimport { insertVisitData } from \"../model/visit\";\nimport { whereCondition, runningNumber, releaseDBConnection } from \"../utils\";\nimport extend from \"extend\";\nimport { addBill, newReceipt } from \"../model/billing\";\nimport httpStatus from \"../utils/httpStatus\";\nimport { debugLog, debugFunction } from \"../utils/logging\";\n\n//created by irfan :to save front desk data inputs\nlet addFrontDesk = (req, res, next) => {\n  debugFunction(\"addFrontDesk\");\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    if (req.query[\"data\"] != null) {\n      req.query = JSON.parse(req.query[\"data\"]);\n      req.body = req.query;\n    }\n\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.beginTransaction(error => {\n        if (error) {\n          connection.rollback(() => {\n            releaseDBConnection(db, connection);\n            next(error);\n          });\n        }\n        //Front Desk Insertion\n        //Patient Details Insertion\n        //Start\n        //Quwery:1\n        runningNumber(\n          req.db,\n          1,\n          \"PATCODE_NUMGEN\",\n          (error, records, newNumber) => {\n            debugLog(\"newNumber:\" + newNumber);\n            if (error) {\n              connection.rollback(() => {\n                releaseDBConnection(db, connection);\n                next(error);\n              });\n            }\n            if (records.length != 0) {\n              req.query.patient_code = newNumber;\n              req.body.patient_code = newNumber;\n\n              //call\n              insertData(\n                connection,\n                req,\n                res,\n                (error, result) => {\n                  if (error) {\n                    connection.rollback(() => {\n                      releaseDBConnection(db, connection);\n                      next(error);\n                    });\n                  }\n\n                  if (result != null && result.length != 0) {\n                    req.query.patient_id = result[0][0][\"hims_d_patient_id\"];\n                    req.body.patient_id = result[0][0][\"hims_d_patient_id\"];\n                    debugLog(\n                      \"req.body.patient_id:\" + result[0][0][\"hims_d_patient_id\"]\n                    );\n                    debugLog(\" succes result of first query\", result);\n\n                    //Visit Insertion\n                    //query 2\n                    runningNumber(\n                      req.db,\n                      2,\n                      \"VISIT_NUMGEN\",\n                      (error, patResults, completeNum) => {\n                        if (error) {\n                          connection.rollback(() => {\n                            releaseDBConnection(db, connection);\n                            next(error);\n                          });\n                        }\n                        req.query.visit_code = completeNum;\n                        req.body.visit_code = completeNum;\n                        debugLog(\"req.body.visit_code : \" + completeNum);\n\n                        //call\n                        insertVisitData(\n                          connection,\n                          req,\n                          res,\n                          (error, resultdata) => {\n                            if (error) {\n                              connection.rollback(() => {\n                                releaseDBConnection(db, connection);\n                                next(error);\n                              });\n                            }\n\n                            //Billing Insertion\n                            //Quwery:3\n                            if (resultdata != null && resultdata.length != 0) {\n                              req.query.visit_id = resultdata[\"insertId\"];\n                              req.body.visit_id = resultdata[\"insertId\"];\n\n                              debugLog(\n                                \"req.body.visit_id:\" + resultdata[\"insertId\"]\n                              );\n\n                              debugLog(\n                                \" succes result of second query\",\n                                resultdata\n                              );\n                              //call\n                              addBill(\n                                connection,\n                                req,\n                                res,\n                                (error, result) => {\n                                  if (error) {\n                                    connection.rollback(() => {\n                                      releaseDBConnection(db, connection);\n                                      next(error);\n                                    });\n                                  }\n\n                                  //Query :4\n                                  //insert receipt\n\n                                  if (result != null && result.length != 0) {\n                                    req.query.billing_header_id =\n                                      result.insertId;\n                                    req.body.billing_header_id =\n                                      result.insertId;\n\n                                    debugLog(\n                                      \"  req.body.billing_header_id:\" +\n                                        result[\"insertId\"]\n                                    );\n\n                                    //call\n\n                                    newReceipt(\n                                      connection,\n                                      req,\n                                      res,\n                                      (error, resultdata) => {\n                                        if (error) {\n                                          connection.rollback(() => {\n                                            releaseDBConnection(db, connection);\n                                            next(error);\n                                          });\n                                        }\n                                        connection.commit(error => {\n                                          releaseDBConnection(db, connection);\n                                          if (error) {\n                                            connection.rollback(() => {\n                                              next(error);\n                                            });\n                                          }\n                                          req.records = result;\n                                          next();\n                                        });\n\n                                        debugLog(\n                                          \"succes result of query 4 : \",\n                                          resultdata\n                                        );\n                                      },\n                                      next\n                                    );\n                                  }\n                                },\n\n                                next\n                              );\n                            }\n                          }\n                        );\n                      }\n                    );\n                  }\n                },\n                true,\n                next\n              );\n            }\n          }\n        );\n        //ruunin\n      });\n      //bign tr\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet selectFrontDesk = (req, res, next) => {\n  let selectWhere = {\n    patient_code: \"ALL\",\n    hims_d_patient_id: \"ALL\"\n  };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      let where = whereCondition(extend(selectWhere, req.query));\n      connection.query(\n        \"SELECT  `hims_d_patient_id`, `patient_code`\\\n      , `registration_date`, `title_id`,`first_name`, `middle_name`, `last_name`,`full_name`, `arabic_name`\\\n      , `gender`, `religion_id`,`date_of_birth`, `age`, `marital_status`, `address1`\\\n      , `address2`,`contact_number`, `secondary_contact_number`, `email`\\\n      , `emergency_contact_name`,`emergency_contact_number`, `relationship_with_patient`\\\n      , `visa_type_id`,`nationality_id`, `postal_code`, `primary_identity_id`\\\n      , `primary_id_no`,`secondary_identity_id`, `secondary_id_no`, `photo_file`\\\n      , `primary_id_file`,`secondary_id_file`,`city_id`,`state_id`,`country_id`, `advance_amount` FROM `hims_f_patient` \\\n       WHERE `record_status`='A' AND \" +\n          where.condition,\n        where.values,\n        (error, result) => {\n          if (error) {\n            releaseDBConnection(db, connection);\n            next(error);\n          }\n          let showresult;\n          if (result.length != 0) {\n            let hims_d_patient_id = result[0][\"hims_d_patient_id\"];\n            connection.query(\n              \"SELECT 0 radioselect, `hims_f_patient_visit_id`, `patient_id`,`visit_code`\\\n            , `visit_type`, `visit_date`, `department_id`, `sub_department_id`\\\n            , `doctor_id`, `maternity_patient`, `is_mlc`, `mlc_accident_reg_no`\\\n            , `mlc_police_station`, `mlc_wound_certified_date`\\\n             FROM `hims_f_patient_visit` WHERE `record_status`='A' AND \\\n             patient_id=? ORDER BY hims_f_patient_visit_id desc \",\n              [hims_d_patient_id],\n              (error, resultFields) => {\n                if (error) {\n                  releaseDBConnection(db, connection);\n                  next(error);\n                }\n                showresult = {\n                  patientRegistration: result[0],\n                  visitDetails: resultFields\n                };\n                req.records = showresult;\n                next();\n              }\n            );\n          } else {\n            req.records = showresult;\n            next();\n          }\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\n//created by irfan :to update front desk\nlet updateFrontDesk = (req, res, next) => {\n  debugFunction(\"updateFrontDesk\");\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    if (req.query[\"data\"] != null) {\n      req.query = JSON.parse(req.query[\"data\"]);\n      req.body = req.query;\n    }\n\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.beginTransaction(error => {\n        if (error) {\n          connection.rollback(() => {\n            releaseDBConnection(db, connection);\n            next(error);\n          });\n        }\n        //Front Desk updation\n\n        //Visit Insertion for update front desk API\n        //query 1\n        runningNumber(\n          req.db,\n          2,\n          \"VISIT_NUMGEN\",\n          (error, patResults, completeNum) => {\n            if (error) {\n              connection.rollback(() => {\n                releaseDBConnection(db, connection);\n                next(error);\n              });\n            }\n            req.query.visit_code = completeNum;\n            req.body.visit_code = completeNum;\n            debugLog(\"req.body.visit_code : \" + completeNum);\n\n            //call\n            insertVisitData(\n              connection,\n              req,\n              res,\n              (error, resultdata) => {\n                if (error) {\n                  connection.rollback(() => {\n                    releaseDBConnection(db, connection);\n                    next(error);\n                  });\n                }\n\n                //Billing Insertion for update front desk APi\n                //Quwery:2\n                if (resultdata != null && resultdata.length != 0) {\n                  req.query.visit_id = resultdata[\"insertId\"];\n                  req.body.visit_id = resultdata[\"insertId\"];\n\n                  debugLog(\"req.body.visit_id:\" + resultdata[\"insertId\"]);\n\n                  debugLog(\" succes result of second query\", resultdata);\n                  //call\n                  addBill(\n                    connection,\n                    req,\n                    res,\n                    (error, result) => {\n                      if (error) {\n                        connection.rollback(() => {\n                          releaseDBConnection(db, connection);\n                          next(error);\n                        });\n                      }\n\n                      //Query :3\n                      //insert receipt for update front desk api\n\n                      if (result != null && result.length != 0) {\n                        req.query.billing_header_id = result.insertId;\n                        req.body.billing_header_id = result.insertId;\n\n                        debugLog(\n                          \"  req.body.billing_header_id:\" + result[\"insertId\"]\n                        );\n\n                        //call\n\n                        newReceipt(\n                          connection,\n                          req,\n                          res,\n                          (error, resultdata) => {\n                            if (error) {\n                              connection.rollback(() => {\n                                releaseDBConnection(db, connection);\n                                next(error);\n                              });\n                            }\n                            connection.commit(error => {\n                              releaseDBConnection(db, connection);\n                              if (error) {\n                                connection.rollback(() => {\n                                  next(error);\n                                });\n                              }\n                              req.records = result;\n                              next();\n                            });\n\n                            debugLog(\"succes result of query 3 : \", resultdata);\n                          },\n                          next\n                        );\n                      }\n                    },\n\n                    next\n                  );\n                }\n              },\n              true,\n              next\n            );\n          }\n        );\n      });\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\nmodule.exports = {\n  addFrontDesk,\n  selectFrontDesk,\n  updateFrontDesk\n};\n"]}