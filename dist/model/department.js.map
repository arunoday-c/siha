{"version":3,"sources":["../../src/model/department.js"],"names":["addDepartment","req","res","next","subDepartment","hims_d_sub_department_id","sub_department_code","sub_department_name","sub_department_desc","department_id","effective_start_date","effective_end_date","sub_department_status","created_by","userIdentity","algaeh_d_app_user_id","updated_by","department","hims_d_department_id","department_code","department_name","department_desc","department_type","hospital_id","department_status","sub_department","db","dataBaseNotInitilizedError","departmentDetails","body","getConnection","error","connection","beginTransaction","rollback","query","Date","result","insertId","commit","resultTables","records","e","updateDepartment","queryBuilder","inputs","resultSelect","deleteDepartment","tableName","id","values","departWhereCondition","selectDepartment","pagePaging","paging","Page","pageNo","page","pageSize","condition","selectSubDepartment","subDepartmentWhereCondition","addSubDepartment","subDepartmentDetails","length","arabic_sub_department_name","resdata","generateError","notFound","updateSubDepartment","release","selectdoctors","inputClicnicalNonClinicalDept","where","connectionString","results","departments","GroupBy","g","sub_department_id","doctors","employee_id","selectDoctorsAndClinic","sub_dept_id","provider_id","module","exports"],"mappings":"AAAA;;AACA;;;;AACA;;AAOA;;;;AACA;;AAEA;;;;AAEA,IAAIA,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACtC,MAAIC,gBAAgB;AAClBC,8BAA0B,IADR;AAElBC,yBAAqB,IAFH;AAGlBC,yBAAqB,IAHH;AAIlBC,yBAAqB,IAJH;AAKlBC,mBAAe,IALG;AAMlBC,0BAAsB,IANJ;AAOlBC,wBAAoB,IAPF;AAQlBC,2BAAuB,IARL;AASlBC,gBAAYZ,IAAIa,YAAJ,CAAiBC,oBATX;AAUlBC,gBAAYf,IAAIa,YAAJ,CAAiBC;AAVX,GAApB;;AAaA,MAAIE,aAAa;AACfC,0BAAsB,IADP;AAEfC,qBAAiB,IAFF;AAGfC,qBAAiB,IAHF;AAIfC,qBAAiB,IAJF;AAKfC,qBAAiB,IALF;AAMfC,iBAAa,IANE;AAOfb,0BAAsB,IAPP;AAQfC,wBAAoB,IARL;AASfa,uBAAmB,IATJ;AAUfX,gBAAYZ,IAAIa,YAAJ,CAAiBC,oBAVd;AAWfC,gBAAYf,IAAIa,YAAJ,CAAiBC,oBAXd;AAYfU,oBAAgB,CAACrB,aAAD;AAZD,GAAjB;;AAeA,MAAI;AACF,QAAIH,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAID,KAAKzB,IAAIyB,EAAb;AACA,QAAIE,oBAAoB,sBAAOX,UAAP,EAAmBhB,IAAI4B,IAAvB,CAAxB;AACAH,OAAGI,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtC,UAAID,KAAJ,EAAW;AACT5B,aAAK4B,KAAL;AACD;AACDC,iBAAWC,gBAAX,CAA4B,iBAAS;AACnC,YAAIF,KAAJ,EAAW;AACTC,qBAAWE,QAAX,CAAoB,YAAM;AACxB,4CAAoBR,EAApB,EAAwBM,UAAxB;AACA7B,iBAAK4B,KAAL;AACD,WAHD;AAID;AACDC,mBAAWG,KAAX,CACE;;;;;;;;;;qCADF,EAYE,CACEP,kBAAkBT,eADpB,EAEES,kBAAkBR,eAFpB,EAGEQ,kBAAkBP,eAHpB,EAIEO,kBAAkBN,eAJpB,EAKEM,kBAAkBL,WALpB,EAMEK,kBAAkBlB,oBANpB,EAOEkB,kBAAkBjB,kBAPpB,EAQEiB,kBAAkBJ,iBARpB,EASE,IAAIY,IAAJ,EATF,EAUER,kBAAkBf,UAVpB,CAZF,EAwBE,UAACkB,KAAD,EAAQM,MAAR,EAAmB;AACjB,cAAIN,KAAJ,EAAW;AACTC,uBAAWE,QAAX,CAAoB,YAAM;AACxB,8CAAoBR,EAApB,EAAwBM,UAAxB;AACA7B,mBAAK4B,KAAL;AACD,aAHD;AAID;AACD,cAAIM,UAAU,IAAd,EAAoB;AAClBT,8BAAkBV,oBAAlB,GAAyCmB,OAAOC,QAAhD;;AAEAN,uBAAWO,MAAX,CAAkB,iBAAS;AACzB,kBAAIR,KAAJ,EAAW;AACTC,2BAAWE,QAAX,CAAoB,YAAM;AACxB,kDAAoBR,EAApB,EAAwBM,UAAxB;AACA7B,uBAAK4B,KAAL;AACD,iBAHD;AAID;AACDC,yBAAWG,KAAX,CACE;;;;;;iHADF,EAQE,CACEP,kBAAkBV,oBADpB,EAEEU,kBAAkBV,oBAFpB,CARF,EAYE,UAACa,KAAD,EAAQS,YAAR,EAAyB;AACvB,gDAAoBd,EAApB,EAAwBM,UAAxB;AACA,oBAAID,KAAJ,EAAW;AACT5B,uBAAK4B,KAAL;AACD;AACD9B,oBAAIwC,OAAJ,GAAcD,YAAd;AACArC;AACD,eAnBH;AAqBD,aA5BD;AA6BD;AACF,SAhEH;AAkED,OAzED;AA0ED,KA9ED;AA+ED,GArFD,CAqFE,OAAOuC,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CArHD;AAHA;;AAyHA,IAAIC,mBAAmB,SAAnBA,gBAAmB,CAAC1C,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzC,MAAIc,aAAa;AACfC,0BAAsB,IADP;AAEfC,qBAAiB,IAFF;AAGfC,qBAAiB,IAHF;AAIfC,qBAAiB,IAJF;AAKfC,qBAAiB,IALF;AAMfC,iBAAa,IANE;AAOfb,0BAAsB,IAPP;AAQfC,wBAAoB,IARL;AASfa,uBAAmB,IATJ;AAUfX,gBAAYZ,IAAIa,YAAJ,CAAiBC,oBAVd;AAWfC,gBAAYf,IAAIa,YAAJ,CAAiBC,oBAXd;AAYfU,oBAAgB,CAACrB,aAAD;AAZD,GAAjB;;AAeA,MAAI;AACF,gCAAc,kBAAd;AACA,QAAIH,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAID,KAAKzB,IAAIyB,EAAb;;AAEA,2BAAS,YAAT,EAAuBzB,IAAI4B,IAA3B;AACA,QAAID,oBAAoB,sBAAOX,UAAP,EAAmBhB,IAAI4B,IAAvB,CAAxB;AACAH,OAAGI,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtC,UAAID,KAAJ,EAAW;AACT5B,aAAK4B,KAAL;AACD;AACDC,iBAAWC,gBAAX,CAA4B,iBAAS;AACnC,YAAIF,KAAJ,EAAW;AACTC,qBAAWE,QAAX,CAAoB,YAAM;AACxB,4CAAoBR,EAApB,EAAwBM,UAAxB;AACA7B,iBAAK4B,KAAL;AACD,WAHD;AAID;AACD,YAAIa,eACF;;;;8DADF;AAMA,YAAIC,SAAS,CACXjB,kBAAkBR,eADP,EAEXQ,kBAAkBP,eAFP,EAGXO,kBAAkBN,eAHP,EAIXM,kBAAkBL,WAJP,EAKXK,kBAAkBlB,oBALP,EAMXkB,kBAAkBjB,kBANP,EAOXiB,kBAAkBJ,iBAPP,EAQX,IAAIY,IAAJ,EARW,EASXR,kBAAkBZ,UATP,EAUXY,kBAAkBV,oBAVP,CAAb;;AAaAc,mBAAWG,KAAX,CAAiBS,YAAjB,EAA+BC,MAA/B,EAAuC,UAACd,KAAD,EAAQM,MAAR,EAAmB;AACxD,cAAIN,KAAJ,EAAW;AACTC,uBAAWE,QAAX,CAAoB,YAAM;AACxB,8CAAoBR,EAApB,EAAwBM,UAAxB;AACA7B,mBAAK4B,KAAL;AACD,aAHD;AAID;AACDC,qBAAWO,MAAX,CAAkB,iBAAS;AACzB,gBAAIR,KAAJ,EAAW;AACTC,yBAAWE,QAAX,CAAoB,YAAM;AACxB,gDAAoBR,EAApB,EAAwBM,UAAxB;AACA7B,qBAAK4B,KAAL;AACD,eAHD;AAID;AACDC,uBAAWG,KAAX,CACE;;;gEADF,EAKE,CAACP,kBAAkBV,oBAAnB,CALF,EAME,UAACa,KAAD,EAAQe,YAAR,EAAyB;AACvB,8CAAoBpB,EAApB,EAAwBM,UAAxB;;AAEA,kBAAID,KAAJ,EAAW;AACT5B,qBAAK4B,KAAL;AACD;AACD9B,kBAAIwC,OAAJ,GAAcK,YAAd;AACA3C;AACD,aAdH;AAgBD,WAvBD;AAwBD,SA/BD;AAgCD,OA1DD;AA2DD,KA/DD;AAgED,GAzED,CAyEE,OAAOuC,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CA5FD;AA6FA,IAAIK,mBAAmB,SAAnBA,gBAAmB,CAAC9C,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzC,MAAI;AACF,QAAIF,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,6BACE;AACED,UAAIzB,IAAIyB,EADV;AAEEsB,iBAAW,mBAFb;AAGEC,UAAIhD,IAAI4B,IAAJ,CAASX,oBAHf;AAIEiB,aACE,8EALJ;AAMEe,cAAQ,CAACjD,IAAI4B,IAAJ,CAASX,oBAAV;AANV,KADF,EASE,kBAAU;AACRjB,UAAIwC,OAAJ,GAAcJ,MAAd;AACAlC;AACD,KAZH,EAaE,iBAAS;AACPA,WAAK4B,KAAL;AACD,KAfH,EAgBE,IAhBF;AAkBD,GAtBD,CAsBE,OAAOW,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CA1BD;;AA4BA,IAAIS,uBAAuB;AACzBhC,mBAAiB,KADQ;AAEzBC,mBAAiB,KAFQ;AAGzBC,mBAAiB,KAHQ;AAIzBC,mBAAiB,KAJQ;AAKzBZ,wBAAsB,KALG;AAMzBC,sBAAoB,KANK;AAOzBa,qBAAmB;AAPM,CAA3B;;AAUA,IAAI4B,mBAAmB,SAAnBA,gBAAmB,CAACnD,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzC,MAAI;AACF,QAAIF,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAI0B,aAAa,EAAjB;AACA,QAAIpD,IAAIqD,MAAJ,IAAc,IAAlB,EAAwB;AACtB,UAAIC,OAAO,mBAAOtD,IAAIqD,MAAX,CAAX;AACAD,oBAAc,YAAYE,KAAKC,MAAjB,GAA0B,GAA1B,GAAgCC,KAAKC,QAAnD;AACD;AACD,gCAAc,yBAAd;AACA,QAAIC,YAAY,2BAAe,sBAAOR,oBAAP,EAA6BlD,IAAIkC,KAAjC,CAAf,CAAhB;AACA,gCACE;AACET,UAAIzB,IAAIyB,EADV;AAEES,aACE;;sHAAA,GAGAwB,UAAUA,SAHV,GAIA,GAJA,GAKAN,UARJ;AASEH,cAAQS,UAAUT;AATpB,KADF,EAYE,kBAAU;AACRjD,UAAIwC,OAAJ,GAAcJ,MAAd;AACAlC;AACD,KAfH,EAgBE,iBAAS;AACPA,WAAK4B,KAAL;AACD,KAlBH,EAmBE,IAnBF;AAqBD,GAhCD,CAgCE,OAAOW,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CApCD;;AAsCA,IAAIkB,sBAAsB,SAAtBA,mBAAsB,CAAC3D,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5C,MAAI0D,8BAA8B;AAChCxD,8BAA0B,KADM;AAEhCC,yBAAqB,KAFW;AAGhCC,yBAAqB,KAHW;AAIhCC,yBAAqB,KAJW;AAKhCC,mBAAe,KALiB;AAMhCC,0BAAsB,KANU;AAOhCC,wBAAoB,KAPY;AAQhCC,2BAAuB;AARS,GAAlC;AAUA,MAAI;AACF,QAAIX,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,gCAAc,4BAAd;AACA,QAAIgC,YAAY,2BACd,sBAAOE,2BAAP,EAAoC5D,IAAIkC,KAAxC,CADc,CAAhB;AAGA,gCACE;AACET,UAAIzB,IAAIyB,EADV;AAEES,aACE;;;oEAAA,GAIAwB,UAAUA,SAPd;AAQET,cAAQS,UAAUT;AARpB,KADF,EAWE,kBAAU;AACRjD,UAAIwC,OAAJ,GAAcJ,MAAd;AACAlC;AACD,KAdH,EAeE,iBAAS;AACPA,WAAK4B,KAAL;AACD,KAjBH,EAkBE,IAlBF;AAoBD,GA5BD,CA4BE,OAAOW,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CA1CD;;AA4CA,IAAIoB,mBAAmB,SAAnBA,gBAAmB,CAAC7D,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAI;AACF,QAAIF,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAID,KAAKzB,IAAIyB,EAAb;AACA,QAAIqC,uBAAuB,sBAAO,EAAP,EAAW9D,IAAI4B,IAAf,CAA3B;AACA;AACAH,OAAGI,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtC,UAAID,KAAJ,EAAW;AACT5B,aAAK4B,KAAL;AACD;AACD;AACAC,iBAAWG,KAAX,CACE,kFADF,EAEE,CAAC4B,qBAAqBtD,aAAtB,CAFF,EAGE,UAACsB,KAAD,EAAQM,MAAR,EAAmB;AACjB,YAAIN,KAAJ,EAAW;AACT,0CAAoBL,EAApB,EAAwBM,UAAxB;AACA7B,eAAK4B,KAAL;AACD;AACD,YAAIM,OAAO2B,MAAP,IAAiB,CAArB,EAAwB;AACtBhC,qBAAWG,KAAX,CACE;;;;;;;;8EADF,EAUE,CACE4B,qBAAqBzD,mBADvB,EAEEyD,qBAAqBxD,mBAFvB,EAGEwD,qBAAqBvD,mBAHvB,EAIEuD,qBAAqBE,0BAJvB,EAKEF,qBAAqBtD,aALvB,EAMEsD,qBAAqBrD,oBANvB,EAOEqD,qBAAqBpD,kBAPvB,EAQEoD,qBAAqBnD,qBARvB,EASE,IAAIwB,IAAJ,EATF,EAUE2B,qBAAqBlD,UAVvB,EAWE,IAAIuB,IAAJ,EAXF,EAYE2B,qBAAqB/C,UAZvB,CAVF,EAwBE,UAACe,KAAD,EAAQmC,OAAR,EAAoB;AAClB,4CAAoBxC,EAApB,EAAwBM,UAAxB;AACA,gBAAID,KAAJ,EAAW;AACT5B,mBAAK4B,KAAL;AACD;AACD9B,gBAAIwC,OAAJ,GAAcyB,OAAd;AACA/D;AACD,WA/BH;AAiCD,SAlCD,MAkCO;AACL,0CAAoBuB,EAApB,EAAwBM,UAAxB;AACA7B,eACE,qBAAWgE,aAAX,CACE,qBAAWC,QADb,EAEE,0BAFF,CADF;AAMD;AACF,OAnDH;AAqDD,KA1DD;AA2DA;AACD,GAnED,CAmEE,OAAO1B,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CApFD;AAqFA,IAAI2B,sBAAsB,SAAtBA,mBAAsB,CAACpE,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,MAAI;AACF,QAAIF,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAID,KAAKzB,IAAIyB,EAAb;AACA,QAAIqC,uBAAuB,sBAAO,EAAP,EAAW9D,IAAI4B,IAAf,CAA3B;AACAH,OAAGI,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtC,UAAID,KAAJ,EAAW;AACT5B,aAAK4B,KAAL;AACD;AACDC,iBAAWG,KAAX,CACE;;;;gEADF,EAME,CACE4B,qBAAqBxD,mBADvB,EAEEwD,qBAAqBvD,mBAFvB,EAGEuD,qBAAqBE,0BAHvB,EAIEF,qBAAqBrD,oBAJvB,EAKEqD,qBAAqBpD,kBALvB,EAMEoD,qBAAqBnD,qBANvB,EAOE,IAAIwB,IAAJ,EAPF,EAQE2B,qBAAqB/C,UARvB,EASE+C,qBAAqB1D,wBATvB,CANF,EAiBE,UAAC0B,KAAD,EAAQM,MAAR,EAAmB;AACjBL,mBAAWsC,OAAX;AACA,YAAIvC,KAAJ,EAAW;AACT5B,eAAK4B,KAAL;AACD;AACD9B,YAAIwC,OAAJ,GAAcJ,MAAd;AACAlC;AACD,OAxBH;AA0BD,KA9BD;AA+BD,GArCD,CAqCE,OAAOuC,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CAvDD;;AAyDA;AACA,IAAI6B,gBAAgB,SAAhBA,aAAgB,CAACtE,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACtC,MAAIqE,gCAAgC;AAClClD,qBAAiB;AADiB,GAApC;AAGA,8BAAc,eAAd;AACA,MAAI;AACF,QAAIrB,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAID,KAAKzB,IAAIyB,EAAb;;AAEA,QAAI+C,QAAQ,sBAAOD,6BAAP,EAAsCvE,IAAIkC,KAA1C,CAAZ;AACAT,OAAGI,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtC,UAAID,KAAJ,EAAW;AACT5B,aAAK4B,KAAL;AACD;AACD,UAAI2C,mBAAmB,EAAvB;AACA,UAAID,MAAMnD,eAAN,IAAyB,UAA7B,EAAyC;AACvCoD,2BAAmB,oDAAnB;AACD,OAFD,MAEO,IAAID,MAAMnD,eAAN,IAAyB,cAA7B,EAA6C;AAClDoD,2BACE,wDADF;AAED;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA1C,iBAAWG,KAAX,CACE;;;;;;;;;;;;;;;;;;;;;;;sHADF,EAyBE,UAACJ,KAAD,EAAQ4C,OAAR,EAAoB;AAClB3C,mBAAWsC,OAAX;AACA,YAAIvC,KAAJ,EAAW;AACT5B,eAAK4B,KAAL;AACD;;AAED,YAAI6C,cAAc,mBAASD,OAAT,EAAkBE,OAAlB,CAA0B;AAAA,iBAAKC,EAAEC,iBAAP;AAAA,SAA1B,CAAlB;AACA,YAAIC,UAAU,mBAASL,OAAT,EAAkBE,OAAlB,CAA0B;AAAA,iBAAKC,EAAEG,WAAP;AAAA,SAA1B,CAAd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAhF,YAAIwC,OAAJ,GAAc,EAAEmC,aAAaA,WAAf,EAA4BI,SAASA,OAArC,EAAd;AACA;AACA7E;AACD,OAlDH;AAoDD,KApFD;AAqFD,GA5FD,CA4FE,OAAOuC,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CApGD;;AAsGA;AACA,IAAIwC,yBAAyB,SAAzBA,sBAAyB,CAACjF,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC/C,MAAIqE,gCAAgC;AAClClD,qBAAiB;AADiB,GAApC;AAGA,8BAAc,eAAd;AACA,MAAI;AACF,QAAIrB,IAAIyB,EAAJ,IAAU,IAAd,EAAoB;AAClBvB,WAAK,qBAAWwB,0BAAX,EAAL;AACD;AACD,QAAID,KAAKzB,IAAIyB,EAAb;;AAEA,QAAI+C,QAAQ,sBAAOD,6BAAP,EAAsCvE,IAAIkC,KAA1C,CAAZ;AACAT,OAAGI,aAAH,CAAiB,UAACC,KAAD,EAAQC,UAAR,EAAuB;AACtC,UAAID,KAAJ,EAAW;AACT5B,aAAK4B,KAAL;AACD;AACD,UAAI2C,mBAAmB,EAAvB;AACA,UAAID,MAAMnD,eAAN,IAAyB,UAA7B,EAAyC;AACvCoD,2BAAmB,oDAAnB;AACD,OAFD,MAEO,IAAID,MAAMnD,eAAN,IAAyB,cAA7B,EAA6C;AAClDoD,2BACE,wDADF;AAED;;AAED1C,iBAAWG,KAAX,CACE;;;;;;;;;;;;;;;;;;;;;;;;sHADF,EA0BE,UAACJ,KAAD,EAAQ4C,OAAR,EAAoB;AAClB3C,mBAAWsC,OAAX;AACA,YAAIvC,KAAJ,EAAW;AACT5B,eAAK4B,KAAL;AACD;;AAED,YAAI6C,cAAc,mBAASD,OAAT,EAAkBE,OAAlB,CAA0B;AAAA,iBAAKC,EAAEK,WAAP;AAAA,SAA1B,CAAlB;AACA,YAAIH,UAAU,mBAASL,OAAT,EAAkBE,OAAlB,CAA0B;AAAA,iBAAKC,EAAEM,WAAP;AAAA,SAA1B,CAAd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAnF,YAAIwC,OAAJ,GAAc,EAAEmC,aAAaA,WAAf,EAA4BI,SAASA,OAArC,EAAd;AACA;AACA7E;AACD,OAnDH;AAqDD,KAjED;AAkED,GAzED,CAyEE,OAAOuC,CAAP,EAAU;AACVvC,SAAKuC,CAAL;AACD;AACF,CAjFD;;AAmFA2C,OAAOC,OAAP,GAAiB;AACftF,8BADe;AAEf2C,oCAFe;AAGfS,oCAHe;AAIfQ,0CAJe;AAKfE,oCALe;AAMfO,0CANe;AAOftB,oCAPe;AAQfwB,8BARe;AASfW;AATe,CAAjB","file":"department.js","sourcesContent":["\"use strict\";\nimport extend from \"extend\";\nimport {\n  selectStatement,\n  paging,\n  whereCondition,\n  deleteRecord,\n  releaseDBConnection\n} from \"../utils\";\nimport httpStatus from \"../utils/httpStatus\";\nimport { LINQ } from \"node-linq\";\n// import $ from \"jquery\";\nimport { logger, debugFunction, debugLog } from \"../utils/logging\";\n\nlet addDepartment = (req, res, next) => {\n  let subDepartment = {\n    hims_d_sub_department_id: null,\n    sub_department_code: null,\n    sub_department_name: null,\n    sub_department_desc: null,\n    department_id: null,\n    effective_start_date: null,\n    effective_end_date: null,\n    sub_department_status: null,\n    created_by: req.userIdentity.algaeh_d_app_user_id,\n    updated_by: req.userIdentity.algaeh_d_app_user_id\n  };\n\n  let department = {\n    hims_d_department_id: null,\n    department_code: null,\n    department_name: null,\n    department_desc: null,\n    department_type: null,\n    hospital_id: null,\n    effective_start_date: null,\n    effective_end_date: null,\n    department_status: null,\n    created_by: req.userIdentity.algaeh_d_app_user_id,\n    updated_by: req.userIdentity.algaeh_d_app_user_id,\n    sub_department: [subDepartment]\n  };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    let departmentDetails = extend(department, req.body);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.beginTransaction(error => {\n        if (error) {\n          connection.rollback(() => {\n            releaseDBConnection(db, connection);\n            next(error);\n          });\n        }\n        connection.query(\n          \"INSERT INTO hims_d_department(department_code \\\n        ,department_name \\\n        ,department_desc \\\n        ,department_type \\\n        ,hospital_id \\\n        ,effective_start_date \\\n        ,effective_end_date \\\n        ,department_status \\\n        ,created_date \\\n        ,created_by \\\n        ) VALUE(?,?,?,?,?,?,?,?,?,?)\",\n          [\n            departmentDetails.department_code,\n            departmentDetails.department_name,\n            departmentDetails.department_desc,\n            departmentDetails.department_type,\n            departmentDetails.hospital_id,\n            departmentDetails.effective_start_date,\n            departmentDetails.effective_end_date,\n            departmentDetails.department_status,\n            new Date(),\n            departmentDetails.created_by\n          ],\n          (error, result) => {\n            if (error) {\n              connection.rollback(() => {\n                releaseDBConnection(db, connection);\n                next(error);\n              });\n            }\n            if (result != null) {\n              departmentDetails.hims_d_department_id = result.insertId;\n\n              connection.commit(error => {\n                if (error) {\n                  connection.rollback(() => {\n                    releaseDBConnection(db, connection);\n                    next(error);\n                  });\n                }\n                connection.query(\n                  \"SELECT `hims_d_department_id`, `department_code`\\\n            , `department_name`, `department_desc`, `department_type`, `hospital_id`\\\n            , `effective_start_date`, `effective_end_date`, `department_status`\\\n             FROM `hims_d_department` WHERE hims_d_department_id=?;\\\n             SELECT `hims_d_sub_department_id`, `sub_department_code`, `sub_department_name`,`arabic_sub_department_name`\\\n             ,`sub_department_desc`, `department_id`, `effective_start_date`\\\n             , `effective_end_date`, `sub_department_status` FROM `hims_d_sub_department` WHERE department_id=?;\",\n                  [\n                    departmentDetails.hims_d_department_id,\n                    departmentDetails.hims_d_department_id\n                  ],\n                  (error, resultTables) => {\n                    releaseDBConnection(db, connection);\n                    if (error) {\n                      next(error);\n                    }\n                    req.records = resultTables;\n                    next();\n                  }\n                );\n              });\n            }\n          }\n        );\n      });\n    });\n  } catch (e) {\n    next(e);\n  }\n};\nlet updateDepartment = (req, res, next) => {\n  let department = {\n    hims_d_department_id: null,\n    department_code: null,\n    department_name: null,\n    department_desc: null,\n    department_type: null,\n    hospital_id: null,\n    effective_start_date: null,\n    effective_end_date: null,\n    department_status: null,\n    created_by: req.userIdentity.algaeh_d_app_user_id,\n    updated_by: req.userIdentity.algaeh_d_app_user_id,\n    sub_department: [subDepartment]\n  };\n\n  try {\n    debugFunction(\"updateDepartment\");\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n\n    debugLog(\"Input Data\", req.body);\n    let departmentDetails = extend(department, req.body);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.beginTransaction(error => {\n        if (error) {\n          connection.rollback(() => {\n            releaseDBConnection(db, connection);\n            next(error);\n          });\n        }\n        let queryBuilder =\n          \"UPDATE `hims_d_department`\\\n        SET   `department_name`=?, `department_desc`=?, `department_type`=?\\\n        ,`hospital_id`=?, `effective_start_date`=?, `effective_end_date`=? \\\n        ,`department_status`=?, `updated_date`=?, `updated_by`=?\\\n        WHERE record_status='A' AND `hims_d_department_id`=?;\";\n        let inputs = [\n          departmentDetails.department_name,\n          departmentDetails.department_desc,\n          departmentDetails.department_type,\n          departmentDetails.hospital_id,\n          departmentDetails.effective_start_date,\n          departmentDetails.effective_end_date,\n          departmentDetails.department_status,\n          new Date(),\n          departmentDetails.updated_by,\n          departmentDetails.hims_d_department_id\n        ];\n\n        connection.query(queryBuilder, inputs, (error, result) => {\n          if (error) {\n            connection.rollback(() => {\n              releaseDBConnection(db, connection);\n              next(error);\n            });\n          }\n          connection.commit(error => {\n            if (error) {\n              connection.rollback(() => {\n                releaseDBConnection(db, connection);\n                next(error);\n              });\n            }\n            connection.query(\n              \"SELECT `hims_d_department_id`, `department_code`\\\n        , `department_name`, `department_desc`, `department_type`, `hospital_id`\\\n        , `effective_start_date`, `effective_end_date`, `department_status`\\\n         FROM `hims_d_department` WHERE hims_d_department_id=?;\",\n              [departmentDetails.hims_d_department_id],\n              (error, resultSelect) => {\n                releaseDBConnection(db, connection);\n\n                if (error) {\n                  next(error);\n                }\n                req.records = resultSelect;\n                next();\n              }\n            );\n          });\n        });\n      });\n    });\n  } catch (e) {\n    next(e);\n  }\n};\nlet deleteDepartment = (req, res, next) => {\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    deleteRecord(\n      {\n        db: req.db,\n        tableName: \"hims_d_department\",\n        id: req.body.hims_d_department_id,\n        query:\n          \"UPDATE hims_d_department SET  record_status='I' WHERE hims_d_department_id=?\",\n        values: [req.body.hims_d_department_id]\n      },\n      result => {\n        req.records = result;\n        next();\n      },\n      error => {\n        next(error);\n      },\n      true\n    );\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet departWhereCondition = {\n  department_code: \"ALL\",\n  department_name: \"ALL\",\n  department_desc: \"ALL\",\n  department_type: \"ALL\",\n  effective_start_date: \"ALL\",\n  effective_end_date: \"ALL\",\n  department_status: \"ALL\"\n};\n\nlet selectDepartment = (req, res, next) => {\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let pagePaging = \"\";\n    if (req.paging != null) {\n      let Page = paging(req.paging);\n      pagePaging += \" LIMIT \" + Page.pageNo + \",\" + page.pageSize;\n    }\n    debugFunction(\"inside selectDepartment\");\n    let condition = whereCondition(extend(departWhereCondition, req.query));\n    selectStatement(\n      {\n        db: req.db,\n        query:\n          \"SELECT `hims_d_department_id`, `department_code`, `department_name`\\\n    , `department_desc`, `department_type`, `hospital_id`, `effective_start_date`\\\n    , `effective_end_date`, `department_status`,`created_date` FROM `hims_d_department` WHERE record_status ='A' AND \" +\n          condition.condition +\n          \" \" +\n          pagePaging,\n        values: condition.values\n      },\n      result => {\n        req.records = result;\n        next();\n      },\n      error => {\n        next(error);\n      },\n      true\n    );\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet selectSubDepartment = (req, res, next) => {\n  let subDepartmentWhereCondition = {\n    hims_d_sub_department_id: \"ALL\",\n    sub_department_code: \"ALL\",\n    sub_department_name: \"ALL\",\n    sub_department_desc: \"ALL\",\n    department_id: \"ALL\",\n    effective_start_date: \"ALL\",\n    effective_end_date: \"ALL\",\n    sub_department_status: \"ALL\"\n  };\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    debugFunction(\"inside selectSubDepartment\");\n    let condition = whereCondition(\n      extend(subDepartmentWhereCondition, req.query)\n    );\n    selectStatement(\n      {\n        db: req.db,\n        query:\n          \"SELECT `hims_d_sub_department_id`, `sub_department_code`\\\n        , `sub_department_name`, `arabic_sub_department_name`, `sub_department_desc`, `department_id`\\\n         , `effective_start_date`, `effective_end_date`, `sub_department_status`\\\n         FROM `hims_d_sub_department` WHERE record_status ='A' AND \" +\n          condition.condition,\n        values: condition.values\n      },\n      result => {\n        req.records = result;\n        next();\n      },\n      error => {\n        next(error);\n      },\n      true\n    );\n  } catch (e) {\n    next(e);\n  }\n};\n\nlet addSubDepartment = (req, res, next) => {\n  // let subDepartment = {\n  //   hims_d_sub_department_id: null,\n  //   sub_department_code: null,\n  //   sub_department_name: null,\n  //   sub_department_desc: null,\n  //   department_id: null,\n  //   effective_start_date: null,\n  //   effective_end_date: null,\n  //   sub_department_status: null,\n  //   created_by: req.userIdentity.algaeh_d_app_user_id,\n  //   updated_by: req.userIdentity.algaeh_d_app_user_id\n  // };\n\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    let subDepartmentDetails = extend({}, req.body);\n    ///1\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      //2\n      connection.query(\n        \"SELECT hims_d_department_id from hims_d_department where hims_d_department_id =?\",\n        [subDepartmentDetails.department_id],\n        (error, result) => {\n          if (error) {\n            releaseDBConnection(db, connection);\n            next(error);\n          }\n          if (result.length != 0) {\n            connection.query(\n              \"INSERT INTO hims_d_sub_department(`sub_department_code`\\\n        , `sub_department_name`\\\n        , `sub_department_desc`,arabic_sub_department_name\\\n        , `department_id`\\\n        , `effective_start_date`\\\n        , `effective_end_date`\\\n        , `sub_department_status`\\\n        , `created_date`\\\n        , `created_by`,updated_date,updated_by)VALUE(?,?,?,?,?,?,?,?,?,?,?,?)\",\n              [\n                subDepartmentDetails.sub_department_code,\n                subDepartmentDetails.sub_department_name,\n                subDepartmentDetails.sub_department_desc,\n                subDepartmentDetails.arabic_sub_department_name,\n                subDepartmentDetails.department_id,\n                subDepartmentDetails.effective_start_date,\n                subDepartmentDetails.effective_end_date,\n                subDepartmentDetails.sub_department_status,\n                new Date(),\n                subDepartmentDetails.created_by,\n                new Date(),\n                subDepartmentDetails.updated_by\n              ],\n              (error, resdata) => {\n                releaseDBConnection(db, connection);\n                if (error) {\n                  next(error);\n                }\n                req.records = resdata;\n                next();\n              }\n            );\n          } else {\n            releaseDBConnection(db, connection);\n            next(\n              httpStatus.generateError(\n                httpStatus.notFound,\n                \"No such deparment exists\"\n              )\n            );\n          }\n        }\n      );\n    });\n    //3\n  } catch (e) {\n    next(e);\n  }\n};\nlet updateSubDepartment = (req, res, next) => {\n  // let subDepartment = {\n  //   hims_d_sub_department_id: null,\n  //   sub_department_code: null,\n  //   sub_department_name: null,\n  //   sub_department_desc: null,\n  //   department_id: null,\n  //   effective_start_date: null,\n  //   effective_end_date: null,\n  //   sub_department_status: null,\n\n  //   created_by: req.userIdentity.algaeh_d_app_user_id,\n\n  //   updated_by: req.userIdentity.algaeh_d_app_user_id\n  // };\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n    let subDepartmentDetails = extend({}, req.body);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      connection.query(\n        \"UPDATE `hims_d_sub_department`\\\n   SET `sub_department_name`=?, `sub_department_desc`=?,arabic_sub_department_name=?\\\n   , `effective_start_date`=?, `effective_end_date`=? \\\n   , `sub_department_status`=?,`updated_date`=?, `updated_by`=?\\\n   WHERE `record_status`='A' AND `hims_d_sub_department_id`=? ;\",\n        [\n          subDepartmentDetails.sub_department_name,\n          subDepartmentDetails.sub_department_desc,\n          subDepartmentDetails.arabic_sub_department_name,\n          subDepartmentDetails.effective_start_date,\n          subDepartmentDetails.effective_end_date,\n          subDepartmentDetails.sub_department_status,\n          new Date(),\n          subDepartmentDetails.updated_by,\n          subDepartmentDetails.hims_d_sub_department_id\n        ],\n        (error, result) => {\n          connection.release();\n          if (error) {\n            next(error);\n          }\n          req.records = result;\n          next();\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\n//created by:Noor to get sub departments\nlet selectdoctors = (req, res, next) => {\n  let inputClicnicalNonClinicalDept = {\n    department_type: \"ALL\"\n  };\n  debugFunction(\"selectdoctors\");\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n\n    let where = extend(inputClicnicalNonClinicalDept, req.query);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      let connectionString = \"\";\n      if (where.department_type == \"CLINICAL\") {\n        connectionString = \" and hims_d_department.department_type='CLINICAL' \";\n      } else if (where.department_type == \"NON-CLINICAL\") {\n        connectionString =\n          \" and hims_d_department.department_type='NON-CLINICAL' \";\n      }\n\n      // connection.query(\n      //   \"select hims_d_sub_department.hims_d_sub_department_id ,sub_department_code,sub_department_name\\\n      //    ,sub_department_desc, arabic_sub_department_name, hims_d_sub_department.department_id,hims_d_department.department_type \\\n      //    from hims_d_sub_department,hims_d_department where \\\n      //    hims_d_sub_department.department_id=hims_d_department.hims_d_department_id \\\n      //    and hims_d_department.record_status='A' and sub_department_status='A' \\\n      //    \" +\n      //     connectionString,\n      //   (error, result) => {\n      //     if (error) {\n      //       connection.release();\n      //       next(error);\n      //     }\n      //     // req.records = result;\n      //     //sbdepartment = extend(sbdepartment, result.body);\n      //     // console.log(sbdepartment);\n      //     //next();\n      //   }\n      // );\n\n      connection.query(\n        \"select hims_m_employee_department_mappings.employee_id,\\\n         hims_m_employee_department_mappings.sub_department_id,\\\n      hims_d_employee.full_name,\\\n      hims_d_employee.arabic_name,\\\n      hims_m_employee_department_mappings.services_id,\\\n      hims_d_sub_department.department_id,\\\n      hims_d_sub_department.sub_department_name,\\\n      hims_d_sub_department.arabic_sub_department_name\\\n      from hims_m_employee_department_mappings,\\\n      hims_d_employee,hims_d_sub_department,hims_d_department,\\\n      hims_d_employee_category,hims_m_category_speciality_mappings\\\n      where\\\n      hims_d_department.hims_d_department_id = hims_d_sub_department.department_id\\\n      and hims_m_employee_department_mappings.employee_id = hims_d_employee.hims_d_employee_id \\\n      and hims_d_sub_department.hims_d_sub_department_id= hims_m_employee_department_mappings.sub_department_id\\\n      and hims_m_employee_department_mappings.record_status='A'\\\n      and hims_d_department.hims_d_department_id = hims_d_sub_department.department_id\\\n      and hims_d_sub_department.record_status='A'\\\n      and hims_d_employee.record_status ='A'\\\n      and hims_d_sub_department.sub_department_status='A'\\\n      and hims_d_employee.employee_status='A'\\\n      and hims_d_department.department_type='CLINICAL'\\\n      and hims_d_employee.isdoctor='Y'\\\n      group by hims_m_employee_department_mappings.employee_id,hims_m_employee_department_mappings.sub_department_id;\",\n        (error, results) => {\n          connection.release();\n          if (error) {\n            next(error);\n          }\n\n          let departments = new LINQ(results).GroupBy(g => g.sub_department_id);\n          let doctors = new LINQ(results).GroupBy(g => g.employee_id);\n          // .SelectMany(s => {\n          //   return s;\n          // })\n          // .ToArray();\n          // .Select(s => {\n          //   debugLog(\"log of \", s);\n          //   return {\n          //     sub_department_id: s.sub_department_id,\n          //     sub_department_name: s.sub_department_name,\n          //     employee_id: s.employee_id\n          //   };\n          // });\n          //.ToArray();\n\n          req.records = { departments: departments, doctors: doctors };\n          //extend(sbdepartment, doctorsInfo);\n          next();\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\n//created by:irfan to get sub departments doctors and clinic\nlet selectDoctorsAndClinic = (req, res, next) => {\n  let inputClicnicalNonClinicalDept = {\n    department_type: \"ALL\"\n  };\n  debugFunction(\"selectdoctors\");\n  try {\n    if (req.db == null) {\n      next(httpStatus.dataBaseNotInitilizedError());\n    }\n    let db = req.db;\n\n    let where = extend(inputClicnicalNonClinicalDept, req.query);\n    db.getConnection((error, connection) => {\n      if (error) {\n        next(error);\n      }\n      let connectionString = \"\";\n      if (where.department_type == \"CLINICAL\") {\n        connectionString = \" and hims_d_department.department_type='CLINICAL' \";\n      } else if (where.department_type == \"NON-CLINICAL\") {\n        connectionString =\n          \" and hims_d_department.department_type='NON-CLINICAL' \";\n      }\n\n      connection.query(\n        \"select hims_m_employee_department_mappings.employee_id as provider_id,\\\n         hims_m_employee_department_mappings.sub_department_id as sub_dept_id,\\\n       hims_d_employee.full_name,\\\n  hims_d_employee.arabic_name,\\\n      hims_m_employee_department_mappings.services_id,\\\n      hims_d_sub_department.department_id,\\\n      hims_d_sub_department.sub_department_name,\\\n      hims_d_sub_department.arabic_sub_department_name,hims_d_appointment_clinic_id as clinic_id,AP.description as clinic_description\\\n      from hims_m_employee_department_mappings,\\\n      hims_d_employee,hims_d_sub_department,hims_d_department,\\\n      hims_d_employee_category,hims_m_category_speciality_mappings,hims_d_appointment_clinic AP\\\n      where\\\n      hims_d_department.hims_d_department_id = hims_d_sub_department.department_id\\\n      and hims_m_employee_department_mappings.employee_id = hims_d_employee.hims_d_employee_id \\\n      and hims_d_sub_department.hims_d_sub_department_id= hims_m_employee_department_mappings.sub_department_id\\\n      and hims_m_employee_department_mappings.record_status='A'\\\n      and hims_d_department.hims_d_department_id = hims_d_sub_department.department_id\\\n      and hims_d_sub_department.record_status='A'\\\n      and hims_d_employee.record_status ='A'\\\n      and hims_d_sub_department.sub_department_status='A'\\\n      and hims_d_employee.employee_status='A'\\\n      and hims_d_department.department_type='CLINICAL'\\\n      and hims_d_employee.isdoctor='Y'\\\n      and AP.record_status='A' and hims_d_employee.hims_d_employee_id=AP.provider_id \\\n      group by hims_m_employee_department_mappings.employee_id,hims_m_employee_department_mappings.sub_department_id;\",\n        (error, results) => {\n          connection.release();\n          if (error) {\n            next(error);\n          }\n\n          let departments = new LINQ(results).GroupBy(g => g.sub_dept_id);\n          let doctors = new LINQ(results).GroupBy(g => g.provider_id);\n          // .SelectMany(s => {\n          //   return s;\n          // })\n          // .ToArray();\n          // .Select(s => {\n          //   debugLog(\"log of \", s);\n          //   return {\n          //     sub_department_id: s.sub_department_id,\n          //     sub_department_name: s.sub_department_name,\n          //     employee_id: s.employee_id\n          //   };\n          // });\n          //.ToArray();\n\n          req.records = { departments: departments, doctors: doctors };\n          //extend(sbdepartment, doctorsInfo);\n          next();\n        }\n      );\n    });\n  } catch (e) {\n    next(e);\n  }\n};\n\nmodule.exports = {\n  addDepartment,\n  updateDepartment,\n  selectDepartment,\n  selectSubDepartment,\n  addSubDepartment,\n  updateSubDepartment,\n  deleteDepartment,\n  selectdoctors,\n  selectDoctorsAndClinic\n};\n"]}