{"version":3,"sources":["../../src/middleware/authmiddleware.js"],"names":["TOKENTIME","SECRET","SECRETKey","authenticate","secret","generateAccessToken","req","res","next","token","result","success","sign","id","body","username","expiresIn","days","duration","asDays","respond","status","json","user","module","exports"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,YAAY,eAAOA,SAAzB;AACA,IAAMC,SAAS,eAAOC,SAAtB;;AAEA,IAAIC,eAAe,0BAAW,EAAEC,QAAQH,MAAV,EAAX,CAAnB;;AAEA,IAAII,sBAAsB,SAAtBA,mBAAsB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5CF,MAAIG,KAAJ,GAAYH,IAAIG,KAAJ,IAAa,EAAzB;AACAH,MAAII,MAAJ,CAAWC,OAAX,GAAqBL,IAAII,MAAJ,CAAWC,OAAX,IAAsB,KAA3C;AACA,MAAIL,IAAII,MAAJ,CAAWC,OAAX,IAAsB,IAA1B,EAAgC;AAC9BL,QAAIG,KAAJ,GAAY,uBAAIG,IAAJ,CACV;AACEC,UAAIP,IAAIQ,IAAJ,CAASC;AADf,KADU,EAIVd,MAJU,EAKV;AACEe,iBAAWhB;AADb,KALU,CAAZ;AASAQ;AACD;AACF,CAfD;AAgBA,IAAMS,OAAO,iBAAOC,QAAP,CAAgBlB,SAAhB,EAA2B,SAA3B,EAAsCmB,MAAtC,EAAb;AACA,IAAIC,UAAU,SAAVA,OAAU,CAACd,GAAD,EAAMC,GAAN,EAAc;AAC1BA,MAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,UAAMjB,IAAIiB,IADS;AAEnBd,WAAOH,IAAIG,KAFQ;AAGnBQ,UAAMA;AAHa,GAArB;AAKD,CAND;;AAQAO,OAAOC,OAAP,GAAiB;AACftB,4BADe;AAEfE,0CAFe;AAGfe;AAHe,CAAjB","file":"authmiddleware.js","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport expressjwt from \"express-jwt\";\r\nimport config from \"../keys/keys\";\r\nimport moment from \"moment\";\r\nconst TOKENTIME = config.TOKENTIME;\r\nconst SECRET = config.SECRETKey;\r\n\r\nlet authenticate = expressjwt({ secret: SECRET });\r\n\r\nlet generateAccessToken = (req, res, next) => {\r\n  req.token = req.token || {};\r\n  req.result.success = req.result.success || false;\r\n  if (req.result.success == true) {\r\n    req.token = jwt.sign(\r\n      {\r\n        id: req.body.username\r\n      },\r\n      SECRET,\r\n      {\r\n        expiresIn: TOKENTIME\r\n      }\r\n    );\r\n    next();\r\n  }\r\n};\r\nconst days = moment.duration(TOKENTIME, \"seconds\").asDays();\r\nlet respond = (req, res) => {\r\n  res.status(200).json({\r\n    user: req.user,\r\n    token: req.token,\r\n    days: days\r\n  });\r\n};\r\n\r\nmodule.exports = {\r\n  authenticate,\r\n  generateAccessToken,\r\n  respond\r\n};\r\n"]}