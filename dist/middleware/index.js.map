{"version":3,"sources":["../../src/middleware/index.js"],"names":["db","api","use","req","res","next","url","token","body","query","headers","verify","SECRETKey","err","decoded","json","success","message","status"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;;;kBAEe,gBAAY;AAAA,MAATA,EAAS,QAATA,EAAS;;AACzB,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,GAAJ,CAAQ,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC1BF,QAAIH,EAAJ,GAASA,EAAT;AACA,QAAIG,IAAIG,GAAJ,IAAW,UAAf,EAA2B;AACzBD;AACD,KAFD,MAEO;AACL,UAAIE,QAAQJ,IAAIK,IAAJ,CAASD,KAAT,IAAkBJ,IAAIM,KAAJ,CAAUF,KAA5B,IAAqCJ,IAAIO,OAAJ,CAAY,WAAZ,CAAjD;AACA,UAAIH,KAAJ,EAAW;AACT,+BAAII,MAAJ,CAAWJ,KAAX,EAAkB,eAAOK,SAAzB,EAAoC,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACpD,cAAID,GAAJ,EAAS;AACP,mBAAOT,IAAIW,IAAJ,CAAS;AACdC,uBAAS,KADK;AAEdC,uBAAS;AAFK,aAAT,CAAP;AAID,WALD,MAKO;AACLd,gBAAIW,OAAJ,GAAcA,OAAd;AACAT;AACD;AACF,SAVD;AAWD,OAZD,MAYO;AACL,eAAOD,IAAIc,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB;AAC1BC,mBAAS,KADiB;AAE1BC,mBAAS;AAFiB,SAArB,CAAP;AAID;AACF;AACF,GAzBD;AA0BA,SAAOhB,GAAP;AACD,C","file":"index.js","sourcesContent":["import { Router } from \"express\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport config from \"../keys/keys\";\r\n\r\nexport default ({ db }) => {\r\n  let api = Router();\r\n\r\n  //add middleware\r\n  api.use((req, res, next) => {\r\n    req.db = db;\r\n    if (req.url == \"/apiAuth\") {\r\n      next();\r\n    } else {\r\n      var token = req.body.token || req.query.token || req.headers[\"x-api-key\"];\r\n      if (token) {\r\n        jwt.verify(token, config.SECRETKey, (err, decoded) => {\r\n          if (err) {\r\n            return res.json({\r\n              success: false,\r\n              message: \"Authentication failed\"\r\n            });\r\n          } else {\r\n            req.decoded = decoded;\r\n            next();\r\n          }\r\n        });\r\n      } else {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: \"no token provided\"\r\n        });\r\n      }\r\n    }\r\n  });\r\n  return api;\r\n};\r\n"]}